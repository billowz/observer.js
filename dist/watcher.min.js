!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("_")):"function"==typeof define&&define.amd?define(["_"],e):"object"==typeof exports?exports.watcher=e(require("_")):t.watcher=e(t._)}(this,function(t){return function(t){function e(r){if(n[r])return n[r].exports;var s=n[r]={exports:{},id:r,loaded:!1};return t[r].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t){return void 0===t||null===t?"":t+""}function i(t){if(o.isArray(t))return t.map(function(t){return t+""});var e=[];return s(t).replace(h,function(t,n,r,s){e.push(r?s.replace(reEscapeChar,"$1"):n||t)}),e}var o=n(1),a=n(2),h=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,u=new Map,c=function(){function t(e,n,s){if(r(this,t),!this.canObserve(e))throw new TypeError("Invalid Param");this.expression=n,this.handlers=[],this.addListen(s),this.path=i(n),this.observers=[],this._observeHandlers=this._initObserveHandlers(),this.target=this._observe(e,0),u[this.expression]=this}return t.prototype.addListen=function(t){var e=this;o.isArray(t)?o.each(t,function(t){o.isFunction(t)&&!o.include(e.handlers,t)&&e.handlers.push(t)}):o.isFunction(t)&&!o.include(this.handlers,t)&&this.handlers.push(t)},t.prototype.removeListen=function(t){o.isArray(t)?o.remove(this.handlers,function(e){return o.include(t,e)}):o.isFunction(t)?o.remove(this.handlers,t):0==arguments.length&&(this.handlers=[])},t.prototype.hasListen=function(){return!!this.handlers.length},t.prototype.canObserve=function(t){return t&&o.isObject(t)},t.prototype.destory=function(){this.target=this._unobserve(this.target,0)},t.prototype._observe=function(t,e){if(e<this.path.length&&this.canObserve(t)){var n=this.path[e];return t[n]=this._observe(t[n],e+1),a.observe(t,n,this._observeHandlers[e])}return t},t.prototype._unobserve=function(t,e){if(e<this.path.length&&this.canObserve(t)){var n=this.path[e],r=void 0;return r=a.unobserve(t,n,this._observeHandlers[e]),r[n]=this._unobserve(t[n],e+1),r}return t},t.prototype._initObserveHandlers=function(){var t=this;return o.map(this.path,function(e,n){return t._createObserveHandler(n)})},t.prototype._createObserveHandler=function(t){var e=this,n=(o.slice(this.path,0,t+1),o.slice(this.path,t+1)),r=this.path.length-t-1;return function(s,i,a){r>0&&(e._unobserve(a,t+1),e._observe(i,t+1),a=o.get(a,n),i=o.get(i,n)),i!==a&&e.handlers&&o.each(e.handlers,function(t){t(e.expression,i,a,e.target)})}},t}(),p=new Map,f=function(t,e){t=a.checkObj(t);var n=p.get(t);return n?n[e]:void 0},d=function(t){var e=a.checkObj(t.target),n=p.get(e);n&&(delete n[t.expression],o.findKey(n)||p["delete"](e))},v={watch:function(t,e,n){var r=f(t,e)||new c(t,e);return r.addListen.apply(r,o.slice(arguments,2)),r.hasListen()?r.target:(d(r),r.destory(),t)},unwatch:function(t,e,n){var r=f(t,e);return r&&(r.removeListen.apply(r,o.slice(arguments,2)),!r.hasListen())?(d(r),r.destory(),t):t},observer:a};t.exports=v},function(e,n){e.exports=t},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t){t._binded!==!0&&(p.set(t.target,t),t._binded=!0)}function i(t){t._binded===!0&&(p.get(t.target)===t&&p["delete"](t.target),t._binded=!1)}function o(t){return p.get(t)}function a(t){return h.isObject(t)&&window.VBProxy&&window.VBProxy.isVBProxy(t)&&(t=window.VBProxy.getVBProxyDesc(t).object),t}var h=n(1),u=function(t){var e=(new Date).getTime(),n=Math.max(0,d.timeoutFrameInterval-(e-f)),r=setTimeout(function(){t(e+n)},n);return f=e+n,r},c=function(t){return window.requestAnimationFrame&&d.useAnimationFrame?window.requestAnimationFrame(t):u(t)},p=new Map,f=0,d={useES7Observe:!0,useAnimationFrame:!1,timeoutFrameInterval:16},v=function(){function t(e){if(r(this,t),!h.isArray(e)&&!h.isObject(e))throw TypeError("can not observe object["+typeof e+"]");this.target=e,this.watchers={},this.listens={},this._onObserveChanged=this._onObserveChanged.bind(this),this._notify=this._notify.bind(this),this.changeRecords={},s(this)}return t.prototype._notify=function(){var t=this;h.map(this.changeRecords,function(e,n){var r=t.listens[n];h.each(r,function(r){var s=t.target[n];a(s)!==a(e)&&r(n,t.target[n],e,t.target)})}),this.__request_frame=null,this.changeRecords={}},t.prototype._addChangeRecord=function(t,e){t in this.changeRecords||(this.changeRecords[t]=e,this.__request_frame||(this.__request_frame=c(this._notify)))},t.prototype._addListen=function(t,e){var n=this.listens[t];n||(n=this.listens[t]=[]),h.each(e,function(t){h.include(n,t)||n.push(t)}),n.length&&this._watch(t)},t.prototype._removeListen=function(t,e){var n=this.listens[t];n&&(e.length&&h.remove(n,function(t){return h.include(e,t)}),e.length&&n.length||(delete this.listens[t],this._unwatch(t)))},t.prototype._onStateChanged=function(t,e){t in this.listens&&this._addChangeRecord(t,e)},t.prototype._onObserveChanged=function(t){var e=this;h.each(t,function(t){e._onStateChanged(t.name,t.oldValue)})},t.prototype._defineProperty=function(t,e){var n=this;this.target=Object.defineProperty(this.target,t,{enumerable:!0,configurable:!0,get:function(){return e},set:function(r){var s=e;e=r,n._onStateChanged(t,s)}})},t.prototype._undefineProperty=function(t,e){this.target=Object.defineProperty(this.target,this.attr,{enumerable:!0,configurable:!0,value:e})},t.prototype._watch=function(t){Object.observe&&d.useES7Observe?this._es7observe||(Object.observe(this.target,this._onObserveChanged),this._es7observe=!0):this.watchers[t]||(this._defineProperty(t,this.target[t]),this.watchers[t]=!0)},t.prototype._unwatch=function(t){Object.observe&&d.useES7Observe?this._es7observe&&this.hasListen()&&(Object.unobserve(this.target,this._onObserveChanged),_es7observe=!1):this.watchers[t]&&(this._undefineProperty(t,this.target[t]),delete this.watchers[t])},t.prototype._parseBindArg=function(t,e){return 1==arguments.length?(e=t,t=h.keys(this.target)):t=h.isArray(t)?h.map(t,function(t){return t+""}):[t+""],h.isArray(e)||(e=[e]),e=h.filter(e,function(t){return h.isFunction(t)}),{attrs:t,handlers:e}},t.prototype.hasListen=function(){return h.findKey(this.listens)},t.prototype.on=function(){var t=this,e=this._parseBindArg.apply(this,arguments);return e.attrs.length&&e.handlers.length&&!function(){var n=a(t.target);h.each(e.attrs,function(t){t in n||(n[t]=void 0)}),h.each(e.attrs,function(n){t._addListen(n,e.handlers)})}(),this.target},t.prototype.un=function(){var t=this,e=this._parseBindArg.apply(this,arguments);return e.attrs.length&&h.each(e.attrs,function(n){t._removeListen(n,e.handlers)}),this.target},t.prototype.destory=function(){Object.observe&&d.useES7Observe?(Object.unobserve(this.target,this._onObserveChanged),this.listens={}):(h.each(this.watchers,function(t){t.unbind()}),this.watchers={}),i(this)},t}();t.exports={checkObj:a,observe:function(t){t=a(t);var e=o(t);e||(e=new v(t));var n=e.on.apply(e,h.slice(arguments,1));return e.hasListen()||e.destory(),n},unobserve:function(t){t=a(t);var e=o(t);if(e){var n=e.un.apply(e,h.slice(arguments,1));return e.hasListen()||e.destory(),n}},_getObserver:function(t){return o(t)},cfg:d,support:!!Object.observe||(void 0!==window.supportDefinePropertyOnObject?window.supportDefinePropertyOnObject:function(){if(!Object.defineProperty)return!1;try{var t=function(){var t=void 0;return Object.defineProperty(object,"sentinel",{get:function(){return t},set:function(e){t=e}}),object.sentinel=1,{v:object.sentinel===t}}();if("object"==typeof t)return t.v}catch(e){return!1}}())}}])});