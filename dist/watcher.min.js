!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("_")):"function"==typeof define&&define.amd?define(["_"],e):"object"==typeof exports?exports.watcher=e(require("_")):t.watcher=e(t._)}(this,function(t){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=n(1),s=n(2),o=/[^\[\]\.]+/g,a=function(){function t(e,n,i){r(this,t),this.target=e,this.expression=n,this.handler=i,this.path=this.parsePath(n),this.observers=[],this._watchItem(this.target,0)}return t.prototype._watchItem=function(t,e){if(!(e>=this.path.length)){var n=this.path[e];(i.isPlainObject(t)||i.isArray(t))&&(this._observe(t,e),this._watchItem(t[n],e+1))}},t.prototype._observe=function(t,e){var n=this,r=function(t,r,s){(i.isPlainObject(s)||i.isArray(s))&&n._unobserve(s,e++)};s.observe(t,attr,r)},t.prototype._unobserve=function(t,e){},t.prototype.parsePath=function(t){for(var e=[],n=void 0;n=o.exec(t);)e.push(n);return e},t}();a.observer=s,t.exports=a},function(e,n){e.exports=t},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t){t._binded!==!0&&(p.set(t.target,t),t._binded=!0)}function s(t){t._binded===!0&&(p.get(t.target)===t&&p["delete"](t.target),t._binded=!1)}function o(t){return p.get(t)}function a(t){return window.VBProxy&&window.VBProxy.isVBProxy(t)&&(t=window.VBProxy.getVBProxyDesc(t).object),t}var h=n(1),c=function(t){var e=(new Date).getTime(),n=Math.max(0,b.timeoutFrameInterval-(e-d)),r=setTimeout(function(){t(e+n)},n);return d=e+n,r},u=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame,f=function(t){return u&&b.useAnimationFrame?u(t):c(t)},p=new Map,d=0,b={useES7Observe:!0,useAnimationFrame:!1,timeoutFrameInterval:16},v=function(){function t(e){if(r(this,t),!h.isArray(e)&&!h.isObject(e))throw TypeError("can not observe object["+typeof e+"]");this.target=e,this.watchers={},this.listens={},this._onObserveChanged=this._onObserveChanged.bind(this),this._notify=this._notify.bind(this),this.changeRecords={},i(this)}return t.prototype._notify=function(){var t=this;h.map(this.changeRecords,function(e,n){var r=t.listens[n];h.each(r,function(r){r(n,t.target[n],e,t.target)})}),this.__request_frame=null,this.changeRecords={}},t.prototype._addChangeRecord=function(t,e){t in this.changeRecords||(this.changeRecords[t]=e,this.__request_frame||(this.__request_frame=f(this._notify)))},t.prototype._addListen=function(t,e){var n=this.listens[t];n||(n=this.listens[t]=[]),h.each(e,function(t){h.include(n,t)||n.push(t)}),n.length&&this._watch(t)},t.prototype._removeListen=function(t,e){var n=this.listens[t];n&&(e.length&&h.remove(n,function(t){return h.include(e,t)}),e.length&&n.length||(delete this.listens[t],this._unwatch(t)))},t.prototype._onStateChanged=function(t,e){t in this.listens&&this._addChangeRecord(t,e)},t.prototype._onObserveChanged=function(t){var e=this;h.each(t,function(t){e._onStateChanged(t.name,t.oldValue)})},t.prototype._defineProperty=function(t,e){this.target=Object.defineProperty(this.target,this.attr,{enumerable:!0,configurable:!0,get:function(){return e},set:function(n){if(e!==n){var r=e;e=n,this._onStateChanged(t,r)}}})},t.prototype._undefineProperty=function(t,e){this.target=Object.defineProperty(this.target,this.attr,{enumerable:!0,configurable:!0,value:e})},t.prototype._watch=function(t){Object.observe&&b.useES7Observe?this._es7observe||(Object.observe(this.target,this._onObserveChanged),this._es7observe=!0):this.watchers[t]||(this._defineProperty(t,this.target[t]),this.watchers[t]=!0)},t.prototype._unwatch=function(t){Object.observe&&b.useES7Observe?this._es7observe&&this.hasListen()&&(Object.unobserve(this.target,this._onObserveChanged),_es7observe=!1):this.watchers[t]&&(this._undefineProperty(t,this.target[t]),delete this.watchers[t])},t.prototype._parseBindArg=function(t,e){return 1==arguments.length?(e=t,t=h.keys(this.target)):t=h.isArray(t)?h.map(t,function(t){return t+""}):[t+""],h.isArray(e)||(e=[e]),e=h.filter(e,function(t){return h.isFunction(t)}),{attrs:t,handlers:e}},t.prototype.hasListen=function(){return h.findKey(this.listens)},t.prototype.on=function(){var t=this,e=this._parseBindArg.apply(this,arguments);return e.attrs.length&&e.handlers.length&&!function(){var n=a(t.target);h.each(e.attrs,function(t){t in n||(n[t]=void 0)}),h.each(e.attrs,function(n){t._addListen(n,e.handlers)})}(),this.target},t.prototype.un=function(){var t=this,e=this._parseBindArg.apply(this,arguments);return e.attrs.length&&h.each(e.attrs,function(n){t._removeListen(n,e.handlers)}),this.target},t.prototype.destory=function(){Object.observe&&b.useES7Observe?(Object.unobserve(this.target,this._onObserveChanged),this.listens={}):(h.each(this.watchers,function(t){t.unbind()}),this.watchers={}),s(this)},t}();t.exports={observe:function(t){t=a(t);var e=o(t);e||(e=new v(t));var n=e.on.apply(e,h.slice(arguments,1));return e.hasListen()||e.destory(),n},unobserve:function(t){t=a(t);var e=o(t);if(e){var n=e.un.apply(e,h.slice(arguments,1));return e.hasListen()||e.destory(),n}},_getObserver:function(t){return o(t)},cfg:b,support:!!Object.observe||(void 0!==window.supportDefinePropertyOnObject?window.supportDefinePropertyOnObject:function(){if(!Object.defineProperty)return!1;try{var t=function(){var t=void 0;return Object.defineProperty(object,"sentinel",{get:function(){return t},set:function(e){t=e}}),object.sentinel=1,{v:object.sentinel===t}}();if("object"==typeof t)return t.v}catch(e){return!1}}())}}])});