!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("_")):"function"==typeof define&&define.amd?define(["_"],e):"object"==typeof exports?exports.observer=e(require("_")):t.observer=e(t._)}(this,function(t){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";t.exports=n(1).assign({},n(2),n(3))},function(e,n){e.exports=t},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t){t._binded!==!0&&(d.set(t.target,t),t._binded=!0)}function o(t){t._binded===!0&&(d.get(t.target)===t&&d["delete"](t.target),t._binded=!1)}function s(t){return d.get(t)}function a(t){return p.isObject(t)&&window.VBProxy&&window.VBProxy.isVBProxy(t)&&(t=window.VBProxy.getVBProxyDesc(t).object),t}function u(t){var e=a(t),n=s(e),r=void 0;return n||(n=new v(e)),r=n.on.apply(n,p.slice(arguments,1)),n.hasListen()||n.destory(),r}function c(t){var e=a(t),n=s(e);if(n){var r=n.un.apply(n,p.slice(arguments,1));return n.hasListen()||n.destory(),r}}var p=n(1),h=function(t){var e=(new Date).getTime(),n=Math.max(0,l.timeoutFrameInterval-(e-y)),r=setTimeout(function(){t(e+n)},n);return y=e+n,r},f=function(t){return window.requestAnimationFrame&&l.useAnimationFrame?window.requestAnimationFrame(t):h(t)},d=new Map,y=0,l={useES7Observe:!0,useAnimationFrame:!1,timeoutFrameInterval:16},v=function(){function t(e){if(r(this,t),!p.isArray(e)&&!p.isObject(e))throw TypeError("can not observe object["+typeof e+"]");this.target=e,this.watchers={},this.listens={},this._onObserveChanged=this._onObserveChanged.bind(this),this._notify=this._notify.bind(this),this.changeRecords={},i(this)}return t.prototype._notify=function(){var t=this;p.map(this.changeRecords,function(e,n){var r=t.listens[n];p.each(r,function(r){var i=t.target[n];a(i)!==a(e)&&r(n,t.target[n],e,t.target)})}),this.__request_frame=null,this.changeRecords={}},t.prototype._addChangeRecord=function(t,e){t in this.changeRecords||(this.changeRecords[t]=e,this.__request_frame||(this.__request_frame=f(this._notify)))},t.prototype._addListen=function(t,e){var n=this.listens[t];n||(n=this.listens[t]=[]),p.each(e,function(t){p.include(n,t)||n.push(t)}),n.length&&this._watch(t)},t.prototype._removeListen=function(t,e){var n=this.listens[t];n&&(e.length&&p.remove(n,function(t){return p.include(e,t)}),e.length&&n.length||(delete this.listens[t],this._unwatch(t)))},t.prototype._onStateChanged=function(t,e){t in this.listens&&this._addChangeRecord(t,e)},t.prototype._onObserveChanged=function(t){var e=this;p.each(t,function(t){e._onStateChanged(t.name,t.oldValue)})},t.prototype._defineProperty=function(t,e){var n=this;this.target=Object.defineProperty(this.target,t,{enumerable:!0,configurable:!0,get:function(){return e},set:function(r){var i=e;e=r,n._onStateChanged(t,i)}})},t.prototype._undefineProperty=function(t,e){this.target=Object.defineProperty(this.target,this.attr,{enumerable:!0,configurable:!0,value:e})},t.prototype._watch=function(t){Object.observe&&l.useES7Observe?this._es7observe||(Object.observe(this.target,this._onObserveChanged),this._es7observe=!0):this.watchers[t]||(this._defineProperty(t,this.target[t]),this.watchers[t]=!0)},t.prototype._unwatch=function(t){Object.observe&&l.useES7Observe?this._es7observe&&!this.hasListen()&&(Object.unobserve(this.target,this._onObserveChanged),this._es7observe=!1):this.watchers[t]&&(this._undefineProperty(t,this.target[t]),delete this.watchers[t])},t.prototype._parseBindArg=function(t,e){return 1==arguments.length?(e=t,t=p.keys(this.target)):t=p.isArray(t)?p.map(t,function(t){return t+""}):[t+""],p.isArray(e)||(e=[e]),e=p.filter(e,function(t){return p.isFunction(t)}),{attrs:t,handlers:e}},t.prototype.hasListen=function(){return p.findKey(this.listens)},t.prototype.on=function(){var t=this,e=this._parseBindArg.apply(this,arguments);return e.attrs.length&&e.handlers.length&&!function(){var n=a(t.target);p.each(e.attrs,function(t){t in n||(n[t]=void 0)}),p.each(e.attrs,function(n){t._addListen(n,e.handlers)})}(),this.target},t.prototype.un=function(){var t=this,e=this._parseBindArg.apply(this,arguments);return e.attrs.length&&p.each(e.attrs,function(n){t._removeListen(n,e.handlers)}),this.target},t.prototype.destory=function(){Object.observe&&l.useES7Observe?(Object.unobserve(this.target,this._onObserveChanged),this.listens={}):(p.each(this.watchers,function(t){t.unbind()}),this.watchers={}),o(this)},t}();t.exports={checkObj:a,observe:u,unobserve:c,cfg:l,support:!!Object.observe||(void 0!==window.supportDefinePropertyOnObject?window.supportDefinePropertyOnObject:function(){if(!Object.defineProperty)return!1;try{var t=function(){var t=void 0;return Object.defineProperty(object,"sentinel",{get:function(){return t},set:function(e){t=e}}),object.sentinel=1,{v:object.sentinel===t}}();if("object"==typeof t)return t.v}catch(e){return!1}}())}},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t){return void 0===t||null===t?"":t+""}function o(t){if(!h.isString(t))return[];var e=[];return i(t).replace(d,function(t,n,r,i){e.push(r?i.replace(reEscapeChar,"$1"):n||t)}),e}function s(t,e){t=f.checkObj(t);var n=v.get(t);return n?n[e]:void 0}function a(t){var e=f.checkObj(t.target),n=v.get(e);n&&(delete n[t.expression],h.findKey(n)||v["delete"](e))}function u(t,e,n,r,i,s,a){if(e&&h.isArray(e)){if(e.length){var u=t;return h.each(e,function(e){u=r(t,e,n)}),u}e=void 0}var c=o(e);return c.length?1==c.length?s(t,e,n):a(t,e,n,c):i(t,n)}function c(t,e,n){var r=arguments;return 2==arguments.length&&(n=e,e=void 0),u(t,e,n,c,f.observe,f.observe,function(t,e,n,i){var o=s(t,e)||new l(t,e,i);return o.addListen.apply(o,h.slice(r,2)),o.hasListen()?o.target:(a(o),o.destory(),t)})}function p(t,e,n){var r=arguments;return 2==arguments.length&&(n=e,e=void 0),u(t,e,n,p,f.unobserve,f.unobserve,function(t,e,n,i){var o=s(t,e);return o?(o.removeListen.apply(o,h.slice(r,2)),o.hasListen()||(a(o),o.destory()),o.target):t})}var h=n(1),f=n(2),d=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,y=new Map,l=function(){function t(e,n,i){if(r(this,t),!this.canObserve(e))throw new TypeError("Invalid Param");this.expression=n,this.handlers=[],this.path=i||o(n),this.observers=[],this._observeHandlers=this._initObserveHandlers(),this.target=this._observe(e,0),y[this.expression]=this}return t.prototype.addListen=function(t){var e=this;h.isArray(t)?h.each(t,function(t){h.isFunction(t)&&!h.include(e.handlers,t)&&e.handlers.push(t)}):h.isFunction(t)&&!h.include(this.handlers,t)&&this.handlers.push(t)},t.prototype.removeListen=function(t){h.isArray(t)?h.remove(this.handlers,function(e){return h.include(t,e)}):h.isFunction(t)?h.remove(this.handlers,t):0==arguments.length&&(this.handlers=[])},t.prototype.hasListen=function(){return!!this.handlers.length},t.prototype.canObserve=function(t){return t&&h.isObject(t)},t.prototype.destory=function(){this.target=this._unobserve(this.target,0)},t.prototype._observe=function(t,e){if(e<this.path.length&&this.canObserve(t)){var n=this.path[e];return t[n]=this._observe(t[n],e+1),f.observe(t,n,this._observeHandlers[e])}return t},t.prototype._unobserve=function(t,e){if(e<this.path.length&&this.canObserve(t)){var n=this.path[e],r=void 0;return r=f.unobserve(t,n,this._observeHandlers[e]),r[n]=this._unobserve(t[n],e+1),r}return t},t.prototype._initObserveHandlers=function(){var t=this;return h.map(this.path,function(e,n){return t._createObserveHandler(n)})},t.prototype._createObserveHandler=function(t){var e=this,n=(h.slice(this.path,0,t+1),h.slice(this.path,t+1)),r=this.path.length-t-1;return function(i,o,s){r>0&&(e._unobserve(s,t+1),e._observe(o,t+1),s=h.get(s,n),o=h.get(o,n)),o!==s&&e.handlers&&h.each(e.handlers,function(t){t(e.expression,o,s,e.target)})}},t}(),v=new Map;t.exports={observe:c,unobserve:p}}])});