!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("_")):"function"==typeof define&&define.amd?define(["_"],e):"object"==typeof exports?exports.observer=e(require("_")):t.observer=e(t._)}(this,function(t){return function(t){function e(r){if(n[r])return n[r].exports;var s=n[r]={exports:{},id:r,loaded:!1};return t[r].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";t.exports=n(1).assignIf({},n(2),n(3))},function(e,n){e.exports=t},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t){return void 0===t||null===t?"":t+""}function i(t){if(c.isArray(t))return t.map(function(t){return t+""});var e=[];return s(t).replace(p,function(t,n,r,s){e.push(r?s.replace(reEscapeChar,"$1"):n||t)}),e}function o(t){var e=u.checkObj(t.target),n=v.get(e);n&&(delete n[t.expression],c.findKey(n)||v["delete"](e))}function a(t,e,n){c.isArray(e)&&c.each(e,function(e){a(t,e,n)});var r=getWatcher(t,e)||new d(t,e);return r.addListen.apply(r,c.slice(arguments,2)),r.hasListen()?r.target:(o(r),r.destory(),t)}function h(t,e,n){c.isArray(e)&&c.each(e,function(e){h(t,e,n)});var r=getWatcher(t,e);return r&&(r.removeListen.apply(r,c.slice(arguments,2)),!r.hasListen())?(o(r),r.destory(),t):t}var c=n(1),u=n(3),p=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,f=new Map,d=function(){function t(e,n,s){if(r(this,t),!this.canObserve(e))throw new TypeError("Invalid Param");this.expression=n,this.handlers=[],this.addListen(s),this.path=i(n),this.observers=[],this._observeHandlers=this._initObserveHandlers(),this.target=this._observe(e,0),f[this.expression]=this}return t.prototype.addListen=function(t){var e=this;c.isArray(t)?c.each(t,function(t){c.isFunction(t)&&!c.include(e.handlers,t)&&e.handlers.push(t)}):c.isFunction(t)&&!c.include(this.handlers,t)&&this.handlers.push(t)},t.prototype.removeListen=function(t){c.isArray(t)?c.remove(this.handlers,function(e){return c.include(t,e)}):c.isFunction(t)?c.remove(this.handlers,t):0==arguments.length&&(this.handlers=[])},t.prototype.hasListen=function(){return!!this.handlers.length},t.prototype.canObserve=function(t){return t&&c.isObject(t)},t.prototype.destory=function(){this.target=this._unobserve(this.target,0)},t.prototype._observe=function(t,e){if(e<this.path.length&&this.canObserve(t)){var n=this.path[e];return t[n]=this._observe(t[n],e+1),u.observe(t,n,this._observeHandlers[e])}return t},t.prototype._unobserve=function(t,e){if(e<this.path.length&&this.canObserve(t)){var n=this.path[e],r=void 0;return r=u.unobserve(t,n,this._observeHandlers[e]),r[n]=this._unobserve(t[n],e+1),r}return t},t.prototype._initObserveHandlers=function(){var t=this;return c.map(this.path,function(e,n){return t._createObserveHandler(n)})},t.prototype._createObserveHandler=function(t){var e=this,n=(c.slice(this.path,0,t+1),c.slice(this.path,t+1)),r=this.path.length-t-1;return function(s,i,o){r>0&&(e._unobserve(o,t+1),e._observe(i,t+1),o=c.get(o,n),i=c.get(i,n)),i!==o&&e.handlers&&c.each(e.handlers,function(t){t(e.expression,i,o,e.target)})}},t}(),v=new Map;getWatcher=function(t,e){t=u.checkObj(t);var n=v.get(t);return n?n[e]:void 0},t.exports={watch:a,unwatch:h}},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t){t._binded!==!0&&(d.set(t.target,t),t._binded=!0)}function i(t){t._binded===!0&&(d.get(t.target)===t&&d["delete"](t.target),t._binded=!1)}function o(t){return d.get(t)}function a(t){return u.isObject(t)&&window.VBProxy&&window.VBProxy.isVBProxy(t)&&(t=window.VBProxy.getVBProxyDesc(t).object),t}function h(t){var e=a(t),n=o(e),r=void 0;return n||(n=new b(e)),r=n.on.apply(n,u.slice(arguments,1)),n.hasListen()||n.destory(),r}function c(t){var e=a(t),n=o(e);if(n){var r=n.un.apply(n,u.slice(arguments,1));return n.hasListen()||n.destory(),r}}var u=n(1),p=function(t){var e=(new Date).getTime(),n=Math.max(0,l.timeoutFrameInterval-(e-v)),r=setTimeout(function(){t(e+n)},n);return v=e+n,r},f=function(t){return window.requestAnimationFrame&&l.useAnimationFrame?window.requestAnimationFrame(t):p(t)},d=new Map,v=0,l={useES7Observe:!0,useAnimationFrame:!1,timeoutFrameInterval:16},b=function(){function t(e){if(r(this,t),!u.isArray(e)&&!u.isObject(e))throw TypeError("can not observe object["+typeof e+"]");this.target=e,this.watchers={},this.listens={},this._onObserveChanged=this._onObserveChanged.bind(this),this._notify=this._notify.bind(this),this.changeRecords={},s(this)}return t.prototype._notify=function(){var t=this;u.map(this.changeRecords,function(e,n){var r=t.listens[n];u.each(r,function(r){var s=t.target[n];a(s)!==a(e)&&r(n,t.target[n],e,t.target)})}),this.__request_frame=null,this.changeRecords={}},t.prototype._addChangeRecord=function(t,e){t in this.changeRecords||(this.changeRecords[t]=e,this.__request_frame||(this.__request_frame=f(this._notify)))},t.prototype._addListen=function(t,e){var n=this.listens[t];n||(n=this.listens[t]=[]),u.each(e,function(t){u.include(n,t)||n.push(t)}),n.length&&this._watch(t)},t.prototype._removeListen=function(t,e){var n=this.listens[t];n&&(e.length&&u.remove(n,function(t){return u.include(e,t)}),e.length&&n.length||(delete this.listens[t],this._unwatch(t)))},t.prototype._onStateChanged=function(t,e){t in this.listens&&this._addChangeRecord(t,e)},t.prototype._onObserveChanged=function(t){var e=this;u.each(t,function(t){e._onStateChanged(t.name,t.oldValue)})},t.prototype._defineProperty=function(t,e){var n=this;this.target=Object.defineProperty(this.target,t,{enumerable:!0,configurable:!0,get:function(){return e},set:function(r){var s=e;e=r,n._onStateChanged(t,s)}})},t.prototype._undefineProperty=function(t,e){this.target=Object.defineProperty(this.target,this.attr,{enumerable:!0,configurable:!0,value:e})},t.prototype._watch=function(t){Object.observe&&l.useES7Observe?this._es7observe||(Object.observe(this.target,this._onObserveChanged),this._es7observe=!0):this.watchers[t]||(this._defineProperty(t,this.target[t]),this.watchers[t]=!0)},t.prototype._unwatch=function(t){Object.observe&&l.useES7Observe?this._es7observe&&!this.hasListen()&&(Object.unobserve(this.target,this._onObserveChanged),_es7observe=!1):this.watchers[t]&&(this._undefineProperty(t,this.target[t]),delete this.watchers[t])},t.prototype._parseBindArg=function(t,e){return 1==arguments.length?(e=t,t=u.keys(this.target)):t=u.isArray(t)?u.map(t,function(t){return t+""}):[t+""],u.isArray(e)||(e=[e]),e=u.filter(e,function(t){return u.isFunction(t)}),{attrs:t,handlers:e}},t.prototype.hasListen=function(){return u.findKey(this.listens)},t.prototype.on=function(){var t=this,e=this._parseBindArg.apply(this,arguments);return e.attrs.length&&e.handlers.length&&!function(){var n=a(t.target);u.each(e.attrs,function(t){t in n||(n[t]=void 0)}),u.each(e.attrs,function(n){t._addListen(n,e.handlers)})}(),this.target},t.prototype.un=function(){var t=this,e=this._parseBindArg.apply(this,arguments);return e.attrs.length&&u.each(e.attrs,function(n){t._removeListen(n,e.handlers)}),this.target},t.prototype.destory=function(){Object.observe&&l.useES7Observe?(Object.unobserve(this.target,this._onObserveChanged),this.listens={}):(u.each(this.watchers,function(t){t.unbind()}),this.watchers={}),i(this)},t}();t.exports={checkObj:a,observe:h,unobserve:c,cfg:l,support:!!Object.observe||(void 0!==window.supportDefinePropertyOnObject?window.supportDefinePropertyOnObject:function(){if(!Object.defineProperty)return!1;try{var t=function(){var t=void 0;return Object.defineProperty(object,"sentinel",{get:function(){return t},set:function(e){t=e}}),object.sentinel=1,{v:object.sentinel===t}}();if("object"==typeof t)return t.v}catch(e){return!1}}())}}])});