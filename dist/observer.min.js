!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("_")):"function"==typeof define&&define.amd?define(["_"],t):"object"==typeof exports?exports.observer=t(require("_")):e.observer=t(e._)}(this,function(e){return function(e){function t(r){if(n[r])return n[r].exports;var s=n[r]={exports:{},id:r,loaded:!1};return e[r].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";e.exports=n(1).assign({},n(2),n(3))},function(t,n){t.exports=e},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e){e._binded!==!0&&(d.set(e.target,e),e._binded=!0)}function i(e){e._binded===!0&&(d.get(e.target)===e&&d["delete"](e.target),e._binded=!1)}function o(e){return d.get(e)}function a(e){return c.isObject(e)&&window.VBProxy&&window.VBProxy.isVBProxy(e)&&(e=window.VBProxy.getVBProxyDesc(e).object),e}function h(e){var t=a(e),n=o(t),r=void 0;return n||(n=new b(t)),r=n.on.apply(n,c.slice(arguments,1)),n.hasListen()||n.destory(),r}function u(e){var t=a(e),n=o(t);if(n){var r=n.un.apply(n,c.slice(arguments,1));return n.hasListen()||n.destory(),r}}var c=n(1),f=function(e){var t=(new Date).getTime(),n=Math.max(0,l.timeoutFrameInterval-(t-v)),r=setTimeout(function(){e(t+n)},n);return v=t+n,r},p=function(e){return window.requestAnimationFrame&&l.useAnimationFrame?window.requestAnimationFrame(e):f(e)},d=new Map,v=0,l={useES7Observe:!0,useAnimationFrame:!1,timeoutFrameInterval:16},b=function(){function e(t){if(r(this,e),!c.isArray(t)&&!c.isObject(t))throw TypeError("can not observe object["+typeof t+"]");this.target=t,this.watchers={},this.listens={},this._onObserveChanged=this._onObserveChanged.bind(this),this._notify=this._notify.bind(this),this.changeRecords={},s(this)}return e.prototype._notify=function(){var e=this;c.map(this.changeRecords,function(t,n){var r=e.listens[n];c.each(r,function(r){var s=e.target[n];a(s)!==a(t)&&r(n,e.target[n],t,e.target)})}),this.__request_frame=null,this.changeRecords={}},e.prototype._addChangeRecord=function(e,t){e in this.changeRecords||(this.changeRecords[e]=t,this.__request_frame||(this.__request_frame=p(this._notify)))},e.prototype._addListen=function(e,t){var n=this.listens[e];n||(n=this.listens[e]=[]),c.each(t,function(e){c.include(n,e)||n.push(e)}),n.length&&this._watch(e)},e.prototype._removeListen=function(e,t){var n=this.listens[e];n&&(t.length&&c.remove(n,function(e){return c.include(t,e)}),t.length&&n.length||(delete this.listens[e],this._unwatch(e)))},e.prototype._onStateChanged=function(e,t){e in this.listens&&this._addChangeRecord(e,t)},e.prototype._onObserveChanged=function(e){var t=this;c.each(e,function(e){t._onStateChanged(e.name,e.oldValue)})},e.prototype._defineProperty=function(e,t){var n=this;this.target=Object.defineProperty(this.target,e,{enumerable:!0,configurable:!0,get:function(){return t},set:function(r){var s=t;t=r,n._onStateChanged(e,s)}})},e.prototype._undefineProperty=function(e,t){this.target=Object.defineProperty(this.target,this.attr,{enumerable:!0,configurable:!0,value:t})},e.prototype._watch=function(e){Object.observe&&l.useES7Observe?this._es7observe||(Object.observe(this.target,this._onObserveChanged),this._es7observe=!0):this.watchers[e]||(this._defineProperty(e,this.target[e]),this.watchers[e]=!0)},e.prototype._unwatch=function(e){Object.observe&&l.useES7Observe?this._es7observe&&!this.hasListen()&&(Object.unobserve(this.target,this._onObserveChanged),this._es7observe=!1):this.watchers[e]&&(this._undefineProperty(e,this.target[e]),delete this.watchers[e])},e.prototype._parseBindArg=function(e,t){return 1==arguments.length?(t=e,e=c.keys(this.target)):e=c.isArray(e)?c.map(e,function(e){return e+""}):[e+""],c.isArray(t)||(t=[t]),t=c.filter(t,function(e){return c.isFunction(e)}),{attrs:e,handlers:t}},e.prototype.hasListen=function(){return c.findKey(this.listens)},e.prototype.on=function(){var e=this,t=this._parseBindArg.apply(this,arguments);return t.attrs.length&&t.handlers.length&&!function(){var n=a(e.target);c.each(t.attrs,function(e){e in n||(n[e]=void 0)}),c.each(t.attrs,function(n){e._addListen(n,t.handlers)})}(),this.target},e.prototype.un=function(){var e=this,t=this._parseBindArg.apply(this,arguments);return t.attrs.length&&c.each(t.attrs,function(n){e._removeListen(n,t.handlers)}),this.target},e.prototype.destory=function(){Object.observe&&l.useES7Observe?(Object.unobserve(this.target,this._onObserveChanged),this.listens={}):(c.each(this.watchers,function(e){e.unbind()}),this.watchers={}),i(this)},e}();e.exports={checkObj:a,observe:h,unobserve:u,cfg:l,support:!!Object.observe||(void 0!==window.supportDefinePropertyOnObject?window.supportDefinePropertyOnObject:function(){if(!Object.defineProperty)return!1;try{var e=function(){var e=void 0;return Object.defineProperty(object,"sentinel",{get:function(){return e},set:function(t){e=t}}),object.sentinel=1,{v:object.sentinel===e}}();if("object"==typeof e)return e.v}catch(t){return!1}}())}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e){return void 0===e||null===e?"":e+""}function i(e){if(!f.isString(e))return[];var t=[];return s(e).replace(d,function(e,n,r,s){t.push(r?s.replace(reEscapeChar,"$1"):n||e)}),t}function o(e,t){e=p.checkObj(e);var n=b.get(e);return n?n[t]:void 0}function a(e){var t=p.checkObj(e.target),n=b.get(t);n&&(delete n[e.expression],f.findKey(n)||b["delete"](t))}function h(e,t,n,r,s,o,a){if(t&&f.isArray(t)){if(t.length){var h=e;return f.each(t,function(t){h=r(e,t,n)}),h}t=void 0}var u=i(t);return u.length?1==u.length?o(e,t,n):a(e,t,n,u):s(e,n)}function u(e,t,n){var r=arguments;return 2==arguments.length&&(n=t,t=void 0),h(e,t,n,u,p.observe,p.observe,function(e,t,n,s){var i=o(e,t)||new l(e,t,s);return i.addListen.apply(i,f.slice(r,2)),i.hasListen()?i.target:(a(i),i.destory(),e)})}function c(e,t,n){var r=arguments;return 2==arguments.length&&(n=t,t=void 0),h(e,t,n,c,p.unobserve,p.unobserve,function(e,t,n,s){var i=o(e,t);return i?(i.removeListen.apply(i,f.slice(r,2)),i.hasListen()||(a(i),i.destory()),i.target):e})}var f=n(1),p=n(2),d=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,v=new Map,l=function(){function e(t,n,s){if(r(this,e),!this.canObserve(t))throw new TypeError("Invalid Param");this.expression=n,this.handlers=[],this.path=s||i(n),this.observers=[],this._observeHandlers=this._initObserveHandlers(),this.target=this._observe(t,0),v[this.expression]=this}return e.prototype.addListen=function(e){var t=this;f.isArray(e)?f.each(e,function(e){f.isFunction(e)&&!f.include(t.handlers,e)&&t.handlers.push(e)}):f.isFunction(e)&&!f.include(this.handlers,e)&&this.handlers.push(e)},e.prototype.removeListen=function(e){f.isArray(e)?f.remove(this.handlers,function(t){return f.include(e,t)}):f.isFunction(e)?f.remove(this.handlers,e):0==arguments.length&&(this.handlers=[])},e.prototype.hasListen=function(){return!!this.handlers.length},e.prototype.canObserve=function(e){return e&&f.isObject(e)},e.prototype.destory=function(){this.target=this._unobserve(this.target,0)},e.prototype._observe=function(e,t){if(t<this.path.length&&this.canObserve(e)){var n=this.path[t];return e[n]=this._observe(e[n],t+1),p.observe(e,n,this._observeHandlers[t])}return e},e.prototype._unobserve=function(e,t){if(t<this.path.length&&this.canObserve(e)){var n=this.path[t],r=void 0;return r=p.unobserve(e,n,this._observeHandlers[t]),r[n]=this._unobserve(e[n],t+1),r}return e},e.prototype._initObserveHandlers=function(){var e=this;return f.map(this.path,function(t,n){return e._createObserveHandler(n)})},e.prototype._createObserveHandler=function(e){var t=this,n=(f.slice(this.path,0,e+1),f.slice(this.path,e+1)),r=this.path.length-e-1;return function(s,i,o){r>0&&(t._unobserve(o,e+1),t._observe(i,e+1),o=f.get(o,n),i=f.get(i,n)),i!==o&&t.handlers&&f.each(t.handlers,function(e){e(t.expression,i,o,t.target)})}},e}(),b=new Map;e.exports={observe:u,unobserve:c}}])});