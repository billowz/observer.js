!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("_")):"function"==typeof define&&define.amd?define(["_"],e):"object"==typeof exports?exports.observer=e(require("_")):t.observer=e(t._)}(this,function(t){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";t.exports=n(1).assign({},n(2),n(4))},function(e,n){e.exports=t},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t){t._binded!==!0&&(d.set(t.target,t),t._binded=!0)}function o(t){t._binded===!0&&(d.get(t.target)===t&&d["delete"](t.target),t._binded=!1)}function s(t){return d.get(t)}function a(t){var e=c.checkObj(t),n=s(e),r=void 0;return n||(n=new v(e)),r=n.on.apply(n,c.slice(arguments,1)),n.hasListen()||n.destory(),r}function u(t){var e=c.checkObj(t),n=s(e);if(n){var r=n.un.apply(n,c.slice(arguments,1));return n.hasListen()||n.destory(),r}return t}var c=n(3),f=["push","pop","shift","unshift","sort","reverse","splice"],p=function(t){var e=(new Date).getTime(),n=Math.max(0,l.timeoutFrameInterval-(e-y)),r=setTimeout(function(){t(e+n)},n);return y=e+n,r},h=function(t){return window.requestAnimationFrame&&l.useAnimationFrame?window.requestAnimationFrame(t):p(t)},d=new Map,y=0,l={useES7Observe:!0,useAnimationFrame:!1,timeoutFrameInterval:16},v=function(){function t(e){if(r(this,t),!c.isArray(e)&&!c.isObject(e))throw TypeError("can not observe object["+typeof e+"]");this.target=e,this._isArray=e instanceof Array,this.watchers={},this.listens={},this._onObserveChanged=this._onObserveChanged.bind(this),this._notify=this._notify.bind(this),this.changeRecords={},i(this)}return t.prototype._notify=function(){var t=this;c.each(this.changeRecords,function(e,n){var r=t.listens[n];c.each(r,function(r){var i=t.target[n];c.eq(i,e)||r(n,t.target[n],e,t.target)})}),this.__request_frame=null,this.changeRecords={}},t.prototype._addChangeRecord=function(t,e){t in this.changeRecords||(this.changeRecords[t]=e,this.__request_frame||(this.__request_frame=h(this._notify)))},t.prototype._addListen=function(t,e){var n=this.listens[t];n||(n=this.listens[t]=[]),c.each(e,function(t){c.include(n,t)||n.push(t)}),n.length&&this._watch(t)},t.prototype._removeListen=function(t,e){var n=this.listens[t];n&&(e.length&&c.remove(n,function(t){return c.include(e,t)}),e.length&&n.length||(delete this.listens[t],this._unwatch(t)))},t.prototype._onStateChanged=function(t,e){t in this.listens&&this._addChangeRecord(t,e)},t.prototype._onObserveChanged=function(t){var e=this;c.each(t,function(t){e._onStateChanged(t.name,t.oldValue)})},t.prototype._defineProperty=function(t,e){var n=this;this.target=Object.defineProperty(this.target,t,{enumerable:!0,configurable:!0,get:function(){return e},set:function(r){var i=e;e=r,n._onStateChanged(t,i)}})},t.prototype._undefineProperty=function(t,e){this.target=Object.defineProperty(this.target,this.attr,{enumerable:!0,configurable:!0,value:e})},t.prototype._watch=function(t){var e=this,n=arguments;Object.observe&&l.useES7Observe?this._es7observe||(Object.observe(this.target,this._onObserveChanged),this._es7observe=!0):this.watchers[t]||(this._isArray&&"length"===t?this._arrayhocks=f.map(function(r){var i=e.target[r];return e.target[r]=function(){var r=e.target.length;i.apply(e.target,n),e.target.length!==r&&e._onStateChanged(t,r)},i}):this._defineProperty(t,this.target[t]),this.watchers[t]=!0)},t.prototype._unwatch=function(t){var e=this;Object.observe&&l.useES7Observe?this._es7observe&&!this.hasListen()&&(Object.unobserve(this.target,this._onObserveChanged),this._es7observe=!1):this.watchers[t]&&(this._isArray&&"length"===t?(f.forEach(function(t,n){e._arrayhocks[n]&&(e.target[t]=e._arrayhocks[n])}),this._arrayhocks==[]):this._undefineProperty(t,this.target[t]),delete this.watchers[t])},t.prototype._parseBindArg=function(t,e){return 1==arguments.length?(e=t,t=c.keys(this.target)):t=c.isArray(t)?c.map(t,function(t){return t+""}):[t+""],c.isArray(e)||(e=[e]),e=c.filter(e,function(t){return c.isFunction(t)}),{attrs:t,handlers:e}},t.prototype.hasListen=function(){for(var t in this.listens)return!0;return!1},t.prototype.on=function(){var t=this,e=this._parseBindArg.apply(this,arguments);return e.attrs.length&&e.handlers.length&&!function(){var n=c.checkObj(t.target);c.each(e.attrs,function(t){t in n||(n[t]=void 0)}),c.each(e.attrs,function(n){t._addListen(n,e.handlers)})}(),this.target},t.prototype.un=function(){var t=this,e=this._parseBindArg.apply(this,arguments);return e.attrs.length&&c.each(e.attrs,function(n){t._removeListen(n,e.handlers)}),this.target},t.prototype.destory=function(){Object.observe&&l.useES7Observe?(Object.unobserve(this.target,this._onObserveChanged),this.listens={}):(c.each(this.watchers,function(t){t.unbind()}),this.watchers={}),o(this)},t}();t.exports={observe:a,unobserve:u,cfg:l,support:!!Object.observe||(void 0!==window.supportDefinePropertyOnObject?window.supportDefinePropertyOnObject:function(){if(!Object.defineProperty)return!1;try{var t=function(){var t=void 0;return object=Object.defineProperty(object,"sentinel",{get:function(){return t},set:function(e){t=e}}),object.sentinel=1,{v:object.sentinel===t}}();if("object"==typeof t)return t.v}catch(e){return!1}}())}},function(t,e,n){"use strict";var r=n(1),i={isObject:function(t){return"object"==typeof t},isArray:function(t){return t&&t instanceof Array},isFunction:function(t){return"function"==typeof t},isString:function(t){return"string"==typeof t},each:function(t,e){if(i.isArray(t))t.forEach(e);else if(i.isObject(t))for(var n in t)e(t[n],n)},map:function(t,e){return t.map(e)},filter:function(t,e){return t.filter(e)},keys:function(t){return Object.keys(t)},include:function(t,e){return-1!=t.indexOf(e)},remove:function(t,e){for(var n=t.length-1;n>=0;n--)e(t[n],n)&&t.splice(n,1)},slice:function(t,e,n){return Array.prototype.slice.call(t,e||0,n||t.length)},checkObj:function(t){return window.VBProxy&&window.VBProxy.isVBProxy(t)?window.VBProxy.getVBProxyDesc(t).object:t},eq:function(t,e){return i.checkObj(t)===i.checkObj(e)},get:r.get};t.exports=i},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t){return void 0===t||null===t?"":t+""}function o(t){if(!p.isString(t))return[];var e=[];return i(t).replace(d,function(t,n,r,i){e.push(r?i.replace(reEscapeChar,"$1"):n||t)}),e}function s(t,e){t=p.checkObj(t);var n=v.get(t);return n?n[e]:void 0}function a(t){var e=p.checkObj(t.target),n=v.get(e);n&&(delete n[t.expression],p.findKey(n)||v["delete"](e))}function u(t,e,n,r,i,s,a){if(e&&p.isArray(e)){if(e.length){var u=t;return p.each(e,function(e){u=r(t,e,n)}),u}e=void 0}var c=o(e);return c.length?1==c.length?s(t,e,n):a(t,e,n,c):i(t,n)}function c(t,e,n){2==arguments.length&&(n=e,e=void 0);var r=arguments;return u(t,e,n,c,h.observe,h.observe,function(t,e,n,i){var o=s(t,e)||new l(t,e,i);return o.addListen.apply(o,p.slice(r,2)),o.hasListen()?o.target:(a(o),o.destory(),t)})}function f(t,e,n){2==arguments.length&&(n=e,e=void 0);var r=arguments;return u(t,e,n,f,h.unobserve,h.unobserve,function(t,e,n,i){var o=s(t,e);return o?(o.removeListen.apply(o,p.slice(r,2)),o.hasListen()||(a(o),o.destory()),o.target):t})}var p=n(3),h=n(2),d=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,y=new Map,l=function(){function t(e,n,i){if(r(this,t),!this.canObserve(e))throw new TypeError("Invalid Param");this.expression=n,this.handlers=[],this.path=i||o(n),this.observers=[],this._observeHandlers=this._initObserveHandlers(),this.target=this._observe(e,0),y[this.expression]=this}return t.prototype.addListen=function(t){var e=this;p.isArray(t)?p.each(t,function(t){p.isFunction(t)&&!p.include(e.handlers,t)&&e.handlers.push(t)}):p.isFunction(t)&&!p.include(this.handlers,t)&&this.handlers.push(t)},t.prototype.removeListen=function(t){p.isArray(t)?p.remove(this.handlers,function(e){return p.include(t,e)}):p.isFunction(t)?p.remove(this.handlers,t):0==arguments.length&&(this.handlers=[])},t.prototype.hasListen=function(){return!!this.handlers.length},t.prototype.canObserve=function(t){return t&&p.isObject(t)},t.prototype.destory=function(){this.target=this._unobserve(this.target,0)},t.prototype._observe=function(t,e){if(e<this.path.length&&this.canObserve(t)){var n=this.path[e];return t[n]=this._observe(t[n],e+1),h.observe(t,n,this._observeHandlers[e])}return t},t.prototype._unobserve=function(t,e){if(e<this.path.length&&this.canObserve(t)){var n=this.path[e],r=void 0;return r=h.unobserve(t,n,this._observeHandlers[e]),r[n]=this._unobserve(t[n],e+1),r}return t},t.prototype._initObserveHandlers=function(){var t=this;return p.map(this.path,function(e,n){return t._createObserveHandler(n)})},t.prototype._createObserveHandler=function(t){var e=this,n=(p.slice(this.path,0,t+1),p.slice(this.path,t+1)),r=this.path.length-t-1;return function(i,o,s){r>0&&(e._unobserve(s,t+1),e._observe(o,t+1),s=p.get(s,n),o=p.get(o,n)),o!==s&&e.handlers&&p.each(e.handlers,function(t){t(e.expression,o,s,e.target)})}},t}(),v=new Map;t.exports={observe:c,unobserve:f}}])});