!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("_")):"function"==typeof define&&define.amd?define(["_"],e):"object"==typeof exports?exports.observer=e(require("_")):t.observer=e(t._)}(this,function(t){return function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return t[i].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t){t._binded!==!0&&(d.set(t.target,t),t._binded=!0)}function s(t){t._binded===!0&&(d.get(t.target)===t&&d["delete"](t.target),t._binded=!1)}function o(t){return d.get(t)}var a=n(1),h="webkit moz ms o".split(" "),u=function(t,e){var n=window[t];return n||(t=a.capitalize(t),t=a.find(h,function(e){return window[e+t]}),n=t?window[t]:null),n||e},c=u("requestAnimationFrame",function(t){var e=(new Date).getTime(),n=Math.max(0,16-(e-f)),i=setTimeout(function(){t(e+n)},n);return f=e+n,i}).bind(window),d=new Map,f=0,p={useES7Observe:!0},g=function(){function t(e,n,r){i(this,t),this.target=e,this.attr=n,this.onChange=r,this.define=Object.getOwnPropertyDescriptor(e,n)||{enumerable:!0,configurable:!0,writable:!0,value:e[n]}}return t.prototype.getValue=function(){return this.define.get?this.define.get.call(this.target):this.define.value},t.prototype.setValue=function(t){var e=this.getValue();t!==e&&(this.define.set?this.define.set.call(this.target,t):this.define.value=t,this.onChange(this.attr,e))},t.prototype.bind=function(){if(!this._binded){var t=Object.defineProperty(this.target,this.attr,{enumerable:!0,configurable:!0,get:this.getValue.bind(this),set:this.setValue.bind(this)});this.target=t,this._binded=!0}return this},t.prototype.unbind=function(){return this._binded&&(this.target=Object.defineProperty(this.target,this.attr,this.define),this._binded=!1),this},t.prototype.isBinded=function(){return!!this._binded},t}(),b=function(){function t(e){if(i(this,t),!a.isArray(e)&&!a.isObject(e))throw TypeError("can not observe object["+typeof e+"]");this.target=e,this.watchers={},this.listens={},this._onObserveChanged=this._onObserveChanged.bind(this),this._notify=this._notify.bind(this),this.changeRecords={},r(this)}return t.prototype._notify=function(){var t=this;a.map(this.changeRecords,function(e,n){var i=t.listens[n];a.each(i,function(i){i(n,t.target[n],e,t.target)})}),this.__request_frame=null,this.changeRecords={}},t.prototype._addChangeRecord=function(t,e){t in this.changeRecords||(this.changeRecords[t]=e,this.__request_frame||(this.__request_frame=c(this._notify)))},t.prototype._addListen=function(t,e){var n=this.listens[t];n||(n=this.listens[t]=[]),a.each(e,function(t){a.include(n,t)||n.push(t)}),n.length&&this._watch(t)},t.prototype._removeListen=function(t,e){var n=this.listens[t];n&&(e.length&&a.remove(n,function(t){return a.include(e,t)}),e.length&&n.length||(delete this.listens[t],this._unwatch(t)))},t.prototype._onStateChanged=function(t,e){t in this.listens&&(console.log("changed:",t," ",e),this._addChangeRecord(t,e))},t.prototype._onObserveChanged=function(t){var e=this;a.each(t,function(t){e._onStateChanged(t.name,t.oldValue)})},t.prototype._watch=function(t){Object.observe&&p.useES7Observe?this._es7observe||(Object.observe(this.target,this._onObserveChanged),this._es7observe=!0):this.watchers[t]||(this.watchers[t]=new g(this.target,t,this._onStateChanged.bind(this)).bind(),this.target=this.watchers[t].target)},t.prototype._unwatch=function(t){Object.observe&&p.useES7Observe?this._es7observe&&this.hasListen()&&(Object.unobserve(this.target,this._onObserveChanged),_es7observe=!1):this.watchers[t]&&(this.watchers[t].unbind(),this.target=this.watchers[t].target,delete this.watchers[t])},t.prototype._parseBindArg=function(t,e){return 1==arguments.length?(e=t,t=a.keys(this.target)):t=a.isArray(t)?a.map(t,function(t){return t+""}):[t+""],a.isArray(e)||(e=[e]),e=a.filter(e,function(t){return a.isFunction(t)}),{attrs:t,handlers:e}},t.prototype.hasListen=function(){return a.findKey(this.listens)},t.prototype.on=function(){var t=this,e=this._parseBindArg.apply(this,arguments);return e.attrs.length&&e.handlers.length&&a.each(e.attrs,function(n){if(t.target.__proxy__){var i=t.target.__proxy__.object;n in i||(i[n]=void 0)}t._addListen(n,e.handlers)}),this.target},t.prototype.un=function(){var t=this,e=this._parseBindArg.apply(this,arguments);return e.attrs.length&&a.each(e.attrs,function(n){t._removeListen(n,e.handlers)}),this.target},t.prototype.destory=function(){Object.observe&&p.useES7Observe?(Object.unobserve(this.target,this._onObserveChanged),this.listens={}):(a.each(this.watchers,function(t){t.unbind()}),this.watchers={}),s(this)},t}();(function(){function t(e,n,r){i(this,t),this.target=e,this.expression=n,this.handler=r,this.observers=[]}return t.prototype.parsePath=function(){},t.prototype.destory=function(){},t})();t.exports={on:function(t){t.__proxy__&&(t=t.__proxy__.object);var e=o(t);e||(e=new b(t));var n=e.on.apply(e,a.slice(arguments,1));return e.hasListen()||e.destory(),n},un:function(t){var e=o(t);if(e){var n=e.un.apply(e,a.slice(arguments,1));return e.hasListen()||e.destory(),n}},_getObserver:function(t){return o(t)},cfg:p,support:!!Object.observe||(void 0!==window.supportDefinePropertyOnObject?window.supportDefinePropertyOnObject:function(){if(!Object.defineProperty)return!1;try{var t=function(){var t=void 0;return Object.defineProperty(object,"sentinel",{get:function(){return t},set:function(e){t=e}}),object.sentinel=1,{v:object.sentinel===t}}();if("object"==typeof t)return t.v}catch(e){return!1}}())}},function(e,n){e.exports=t}])});