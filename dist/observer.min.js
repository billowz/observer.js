!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.observer=t():e.observer=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),o=r(i),s=n(2),a=r(s);a["default"].proxy=o["default"],t["default"]=a["default"],e.exports=t["default"]},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(){n(this,e),this.proxyEvents=new Map}return r(e,[{key:"isEnable",value:function(){return window.VBProxy}},{key:"obj",value:function(e){return window.VBProxy&&window.VBProxy.isVBProxy(e)?window.VBProxy.getVBProxyDesc(e).object:e}}]),r(e,[{key:"onProxy",value:function(e,t){var n=void 0;if(window.VBProxy){if("function"!=typeof t)throw TypeError("Invalid Proxy Event Handler");e=this.obj(e),n=this.proxyEvents.get(e),n||(n=[],this.proxyEvents.set(e,n)),n.push(t)}}},{key:"unProxy",value:function(e,t){var n=void 0;if(window.VBProxy&&(e=this.obj(e),n=this.proxyEvents.get(e)))if(arguments.length>1){if("function"==typeof t){var r=n.indexOf(t);-1!=r&&n.splice(r,1)}}else this.proxyEvents["delete"](e)}},{key:"_fire",value:function(e){if(window.VBProxy&&window.VBProxy.isVBProxy(e)){var t=window.VBProxy.getVBProxyDesc(t).object,n=this.proxyEvents.get(t);if(n)for(var r=0;r<n.length;r++)n[r](t,e)}}}]),e}();t["default"]=new i,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(3),a=r(s),u=n(4),f=r(u),c=function(){function e(){i(this,e),this.exps=new Map}return o(e,[{key:"_bind",value:function(e){var t=f["default"].obj(e.target),n=this.exps.get(t);n||(n={},this.exps.set(t,n)),n[e.expression]=e}},{key:"_unbind",value:function(e){var t=f["default"].obj(e.target),n=this.exps.get(t);if(n&&n[e.expression]===e){delete n[e.expression];for(var r in n)return;this.exps["delete"](t)}}},{key:"_get",value:function(e,t){var n=void 0;return e=f["default"].obj(t.target),n=this.exps.get(e),n?n[t]:void 0}},{key:"_on",value:function(e,t,n){var r=toPath(t);if(r.length>1){var i=this._get(e,i);return i||(i=new a["default"](e,i,r),this._bind(i)),i.addListen(n),i.target}return f["default"].on(e,t,n)}},{key:"_un",value:function(e,t,n){var r=toPath(t);if(r.length>1){var i=this._get(e,i);return i&&i.removeListen(n),i.hashListen()?i.target:(this._unbind(i),i.destory())}return f["default"].un(e,t,n)}},{key:"on",value:function(e){if(arguments.length<2)throw TypeError("Invalid Parameter");if(2===arguments.length){var t=arguments[1];if("function"==typeof t)return f["default"].on(e,t);if(!t||"object"!=typeof t)throw TypeError("Invalid Parameter");for(var n in t){if("function"!=typeof t[n])throw TypeError("Invalid Observer Handler");e=this._on(e,n,t[n])}}else if(arguments.length>=3){var r=void 0,i=[],o=void 0;for(r=0;r<arguments.length;r++){if("function"==typeof arguments[r]){o=arguments[r];break}arguments[r]instanceof Array?i.push.apply(i,arguments[r]):i.push(arguments[r])}if(!o)throw TypeError("Invalid Observer Handler",o);for(r=0;r<i.length;r++)e=this._on(e,i[r]+"",o)}return e}},{key:"un",value:function(e){if(arguments.length<1)throw TypeError("Invalid Parameter");if(1===arguments.length)return f["default"].un(e);if(2===arguments.length){var t=arguments[1];if(t instanceof Array)for(var n=0;n<t.length;n++)e=this._on(e,t);else if(t&&"object"==typeof t)for(var r in t)e=this._un(e,r,t[r]);else e=this._un(e,t+"")}else if(arguments.length>=3){var n=void 0;for(exps=[],handler=void 0,n=0;n<arguments.length;n++){if("function"==typeof arguments[n]){handler=arguments[n];break}arguments[n]instanceof Array?exps.push.apply(exps,arguments[n]):exps.push(arguments[n])}for(n=0;n<exps.length;n++)e=this._un(e,exps[n]+"",handler)}return e}}]),e}();c.prototype.obj=f["default"].obj,c.prototype.eq=f["default"].eq,t["default"]=new c,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){return void 0===e||null===e?"":e+""}function s(e){var t=[];return"string"==typeof e&&o(e).replace(c,function(e,n,r,i){t.push(r?i.replace(reEscapeChar,"$1"):n||e)}),t}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(4),f=r(u),c=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,h=function(){function e(t,n,r){i(this,e),this.expression=n,this.handlers=[],this.path=r||s(n),this.observers=[],this.observeHandlers=this._initObserveHandlers(),this.target=this._observe(t,0)}return a(e,[{key:"_observe",value:function(e,t){var n=this.path[t];return t+1<this.path.length&&(e[n]=this._observe(e[n],t+1)),f["default"].on(e,n,this.observeHandlers[t])}},{key:"_unobserve",value:function(e,t){var n=this.path[t];return e=f["default"].un(e,n,this.observeHandlers[t]),t+1<this.path.length&&(e[n]=this._unobserve(e[n],t+1)),e}},{key:"_initObserveHandlers",value:function(){var e=[],t=void 0;for(t=0;t<this.path;t++)e[t]=this._createObserveHandler(t);return e}},{key:"_createObserveHandler",value:function(t){var n=this,r=(this.path.slice(0,t+1),this.path.slice(t+1)),i=this.path.length-t-1;return function(o,s,a){if(i>0&&(n._unobserve(a,t+1),n._observe(s,t+1),a=e.get(a,r),s=e.get(s,r)),s!==a&&n.handlers)for(var u=0;u<n.handlers.length;u++)n.handlers[u](n.expression,s,a,n.target)}}},{key:"addListen",value:function(){for(var e=0;e<arguments.length;e++)"function"==typeof arguments[e]&&this.handlers.push(arguments[e])}},{key:"removeListen",value:function(){if(0==arguments.length)this.handlers=[];else for(var e=0;e<arguments.length;e++)if("function"==typeof arguments[e]){var t=this.handlers.indexOf(arguments[e]);-1!==t&&this.handlers.splice(t,1)}}},{key:"hasListen",value:function(){return!!this.handlers.length}},{key:"destory",value:function(){var e=this._unobserve(this.target,0);return this.target=void 0,this.expression=void 0,this.handlers=void 0,this.path=void 0,this.observers=void 0,this.observeHandlers=void 0,this.target=void 0,e}}],[{key:"get",value:function(){}}]),e}();t["default"]=h,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(5),a=r(s),u=function(){function e(){i(this,e),this.observers=new Map}return o(e,[{key:"_bind",value:function(e){this.observers.set(e.target,e)}},{key:"_unbind",value:function(e){this.observers.get(e.target)===e&&this.observers["delete"](e.target)}},{key:"_get",value:function(e){return this.observers.get(e)}},{key:"on",value:function(e){var t=a["default"].obj(e),n=this._get(t);return n||(n=new a["default"](t),this._bind(n)),t=n.on.apply(n,Array.prototype.slice.call(arguments,1)),n.hasListen()||(this._unbind(n),n.destroy()),t}},{key:"un",value:function(e){var t=a["default"].obj(e),n=this._get(t);return n&&(t=n.un.apply(n,Array.prototype.slice.call(arguments,1)),n.hasListen()||(this._unbind(n),n.destroy())),t}}]),e}();u.prototype.obj=a["default"].obj,u.prototype.eq=a["default"].eq,t["default"]=new u,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(1),a=r(s),u=["push","pop","shift","unshift","sort","reverse","splice"],f=function(){function e(t){if(i(this,e),t instanceof Array)this.isArray=!0;else{if(!t||"object"!=typeof t)throw TypeError("can not observe object["+typeof t+"]");this.isArray=!1}this.target=t,this.watchers={},this.listens={},this.changeRecords={},this._notify=this._notify.bind(this),this._onObserveChanged=this._onObserveChanged.bind(this),this._onStateChanged=this._onStateChanged.bind(this)}return o(e,null,[{key:"eq",value:function(e,t){return a["default"].obj(e)===a["default"].obj(t)}}]),o(e,[{key:"_notify",value:function(){var t=void 0,n=void 0,r=void 0,i=void 0,o=void 0;for(t in this.changeRecords)if(n=this.target[t],r=this.changeRecords[t],!e.eq(n,r))for(i=this.listens[t],o=0;o<i.length;o++)i[o](t,n,r,this.target);this.request_frame=null,this.changeRecords={}}},{key:"_addChangeRecord",value:function(e,t){e in this.changeRecords||(this.changeRecords[e]=t,this.request_frame||(this.request_frame=requestAnimationFrame(this._notify)))}},{key:"_onStateChanged",value:function(e,t){this._addChangeRecord(e,t)}},{key:"_onObserveChanged",value:function(e){for(var t=0;t<e.length;t++)this.listens[e[t].name]&&this._onStateChanged(e[t].name,e[t].oldValue)}},{key:"_defineProperty",value:function(e,t){var n=this;this.target=Object.defineProperty(this.target,e,{enumerable:!0,configurable:!0,get:function(){return t},set:function(r){var i=t;t=r,n._onStateChanged(e,i)}}),a["default"]._fire(this.target)}},{key:"_undefineProperty",value:function(e,t){this.target=Object.defineProperty(this.target,this.attr,{enumerable:!0,configurable:!0,value:t})}},{key:"_hockArrayLength",value:function(e){var t=this,n=arguments,r=this.target[e];return this.target[e]=function(){var e=t.target.length;r.apply(t.target,n),t.target.length!==e&&t._onStateChanged(attr,e)},r}},{key:"_watch",value:function(e){if(Object.observe)this.es7observe||(Object.observe(this.target,this._onObserveChanged),this.es7observe=!0);else if(!this.watchers[e]){if(this.isArray&&"length"===e){this.arrayhocks=[];for(var t=0;t<u.length;t++)this.arrayhocks[t]=this._hockArrayLength(u[t])}else this._defineProperty(e,this.target[e]);this.watchers[e]=!0}}},{key:"_unwatch",value:function(e){if(Object.observe)this.es7observe&&!this.hasListen()&&(Object.unobserve(this.target,this._onObserveChanged),this.es7observe=!1);else if(this.watchers[e]){if(this._isArray&&"length"===e){for(var t=0;t<u.length;t++)this.target[method]=this.arrayhocks[t];this.arrayhocks==[]}else this._undefineProperty(e,this.target[e]);delete this.watchers[e]}}},{key:"_addListen",value:function(e,t){var n=this.listens[e];if("function"!=typeof t)throw TypeError("Invalid Observer Handler",t);n||(n=this.listens[e]=[]),n.push(t),this._watch(e)}},{key:"_removeListen",value:function(e,t){var n=void 0,r=void 0;e in this.listens&&(n=this.listens[e]||[],t?-1!==(r=n.indexOf(t))&&n.splice(r,1):n=[],n.length||(delete this.listens[e],this._unwatch(e)))}},{key:"hasListen",value:function(){for(var e in this.listens)return!0;return!1}},{key:"on",value:function(e,t){if(1==arguments.length)if("function"==typeof e)for(var n in this.target)this._addListen(n,e);else{if(!e||"object"!=typeof e)throw TypeError("Invalid Parameter",arguments);for(var r in e){if(t=e[r],"function"!=typeof t)throw TypeError("Invalid Observer Handler",t);this._addListen(r,t)}}else{if(!(arguments.length>=2))throw TypeError("Invalid Parameter",arguments);var i=void 0;for(e=[],t=void 0,i=0;i<arguments.length;i++){if("function"==typeof arguments[i]){t=arguments[i];break}arguments[i]instanceof Array?e.push.apply(e,arguments[i]):e.push(arguments[i])}if(!t)throw TypeError("Invalid Observer Handler",t);for(i=0;i<e.length;i++)this._addListen(e[i]+"",t)}return this.target}},{key:"un",value:function(e,t){if(0==arguments.length)for(var n in this.target)this._removeListen(n);else if(1==arguments.length)if(e instanceof Array)for(var r=0;r<e.length;r++)this._removeListen(e[r]+"");else if(e&&"object"==typeof e)for(var i in e)this._removeListen(i,e[i]);else this._removeListen(e+"");else{if(!(arguments.length>=2))throw TypeError("Invalid Parameter",arguments);var r=void 0;for(e=[],t=void 0,r=0;r<arguments.length;r++){if("function"==typeof arguments[r]){t=arguments[r];break}arguments[r]instanceof Array?e.push.apply(e,arguments[r]):e.push(arguments[r])}for(r=0;r<e.length;r++)this._removeListen(e[r]+"",t)}return this.target}},{key:"destroy",value:function(){for(var e in this.listens)this._removeListen(e);this.request_frame&&(cancelAnimationFrame(this.request_frame),this.request_frame=void 0),this.target=void 0,this.watchers=void 0,this.listens=void 0,this.changeRecords=void 0}}]),e}();t["default"]=f,f.obj=a["default"].obj,e.exports=t["default"]}])});