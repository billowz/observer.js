!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("observer",e):t.observer=e()}(this,function(){function t(t){var e=(new Date).getTime(),n=Math.max(0,16-(e-et)),r=setTimeout(function(){t(e+n)},n);return et=e+n,r}function e(t){clearTimeout(t)}function n(t,e,n){t.prototype[e]||(t.prototype[e]=n)}function r(t){h(t)&&(it=t)}function i(){return it}function o(t,e){return it.call(t,e)}function s(t){return void 0!==t}function c(t){return null===t}function a(t){return void 0===t||null===t}function u(t){return rt.call(t)===st}function h(t){return rt.call(t)===ct}function f(t){return rt.call(t)===ut}function l(t){return rt.call(t)===at}function p(t){return rt.call(t)===ht}function d(t){return rt.call(t)===ft}function v(t){return rt.call(t)===lt}function g(t){return rt.call(t)===pt}function y(t){var e=rt.call(t);switch(e){case ot:case st:case ft:case dt:return!0;default:if(t){var n=t.length;return f(n)&&(n?n>0&&n-1 in t:0===n)}return!1}}function b(t,e,n,r){var i=void 0,s=void 0;n=n||t;for(i in t)if(s=o(t,i),(r===!1||s)&&e.call(n,t[i],i,t,s)===!1)return!1;return!0}function _(t,e,n){var r=0,i=t.length;for(n=n||t;r<i;r++)if(e.call(n,t[r],r,t,!0)===!1)return!1;return!0}function m(t,e,n,r){return y(t)?_(t,e,n):!!a(t)||b(t,e,n,r)}function P(t,e,n,r){function i(t,n){o[n]=e.apply(this,arguments)}var o=void 0;return y(t)?(o=[],_(t,i,n)):(o={},a(t)||b(t,i,n,r)),o}function w(t,e,n,r){var i=void 0;return y(t)?(i=[],_(t,function(t){e.apply(this,arguments)&&i.push(t)},n)):(i={},a(t)||b(t,function(t,n){e.apply(this,arguments)&&(i[n]=t)},n,r)),i}function j(t,e,n,r,i){var o=n;return m(t,function(t,n,r,i){o=e.call(this,o,t,n,r,i)},r,i),o}function x(t,e,n,r){var i=[];return m(t,function(t,n){e&&!e.apply(this,arguments)||i.push(n)},n,r),i}function O(t,e){for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return n;return-1}function C(t,e){for(var n=t.length;n-- >0;)if(t[n]===e)return n}function E(t,e,n){for(key in t)if((n===!1||o(t,key))&&t[key]===e)return key}function F(t,e,n){return y(t)?O(t,e):E(t,e,n)}function S(t,e,n){return y(t)?C(t,e):E(t,e,n)}function A(t,e,n,r,i){var o={};return m(t,function(t,r){o[e?e.apply(this,arguments):r]=n?n.apply(this,arguments):t},r,i),o}function R(t,e,n,r){var i={};return m(t,function(t,n){i[t]=e?e.apply(this,arguments):n},n,r),i}function N(t){return t.toUpperCase()}function k(t){return t.replace(vt,N)}function B(t){return t.replace(gt,"")}function L(t){return t.replace(yt,"")}function q(t){return t.replace(bt,"")}function H(t,e,n,r){var i=t.length>=e?"":Array(1+e-t.length>>>0).join(n);return r?t+i:i+t}function K(t,e,n,r,i){var o=r-t.length;return o>0?n||!i?H(t,r," ",n):t.slice(0,e.length)+H("",o,"0",!0)+t.slice(e.length):t}function M(t){return T(t,Array.prototype.slice.call(arguments,1)).format}function T(t,e){var n=0;return t=t.replace(_t,function(t,r,i,o,s,c,a){if("%%"==t)return"%";var u=!1,h="",f=!1,l=!1;if(i&&m(i,function(t){switch(t){case" ":h=" ";break;case"+":h="+";break;case"-":u=!0;break;case"0":f=!0;break;case"#":l=!0}}),o=o?"*"==o?+e[n++]:"*"==o.charAt(0)?+e[o.slice(1,-1)]:+o:0,o<0&&(o=-o,u=!0),!isFinite(o))throw new Error("sprintf: (minimum-)width must be finite");c&&"*"==c.charAt(0)&&(c=+e["*"==c?n++:c.slice(1,-1)],c<0&&(c=null)),c=null==c?"fFeE".indexOf(a)>-1?6:"d"==a?0:void 0:+c;var p=r?e[r.slice(0,-1)]:e[n++],d=void 0,v=void 0;switch(a){case"c":p=String.fromCharCode(+p);case"s":p=String(p),null!=c&&(p=p.slice(0,c)),d="";break;case"b":v=2;break;case"o":v=8;break;case"u":v=10;break;case"x":case"X":v=16;break;case"i":case"d":var g=parseInt(+p);if(isNaN(g))return"";d=g<0?"-":h,p=d+H(String(Math.abs(g)),c,"0",!1);break;case"e":case"E":case"f":case"F":case"g":case"G":case"p":case"P":var y=+p;if(isNaN(y))return"";d=y<0?"-":h;var b=void 0;if("p"!=a.toLowerCase())b=["toExponential","toFixed","toPrecision"]["efg".indexOf(a.toLowerCase())];else{var _=String(p).replace(/[eE].*|[^\d]/g,"");_=(y?_.replace(/^0+/,""):_).length,c=c?Math.min(c,_):c,b=!c||c<=_?"toPrecision":"toExponential"}var P=Math.abs(y)[b](c);p=d+P;break;case"n":return"";default:return t}if(v){var w=p>>>0;d=l&&10!=v&&w&&["0b","0","0x"][v>>3]||"",p=d+H(w.toString(v),c||0,"0",!1)}var j=K(p,d,u,o,f);return"EFGPX".indexOf(a)>-1?j.toUpperCase():j}),{format:t,formatArgCount:n}}function I(t,e){if(u(t))return t;if(!d(t))return[];var n=function(){var n=mt[t];return n?{v:n}:(n=e?mt[t]=[]:[],t.replace(Pt,function(t,e,r,i){n.push(r?i.replace(wt,"$1"):e||t)}),{v:n})}();return"object"==typeof n?n.v:void 0}function G(t,e,n,r,i){for(var s=0,c=I(e,!0),u=c.length-1,h=void 0;!a(t)&&s<u;){if(h=c[s++],i&&!o(t,h))return n;t=t[h]}return h=c[s],s==u&&!a(t)&&(i?o(t,h):h in t)?t[h]:n}function D(t,e,n,r){for(var i=0,s=I(e,!0),c=s.length-1,u=void 0;!a(t)&&i<c;){if(u=s[i++],r&&!o(t,u))return!1;t=t[u]}return u=s[i],i==c&&!a(t)&&(r?o(t,u):u in t)}function V(t,e,n){for(var r=0,i=I(e,!0),o=i.length-1,s=i[0],c=t;r<o;r++)c=a(c[s])?c[s]={}:c[s],s=i[r+1];return c[s]=n,t}function $(t,e){return o(t,e)?t[e]:void 0}function z(t){for(var e=void 0,n=void 0,r=1,i=arguments.length;r<i;r++){e=arguments[r];for(n in e)o(e,n)&&!o(t,n)&&(t[n]=e[n])}return t}function X(){}function Y(t,e){if(!h(t))return t instanceof e;for(var n=t;(n=jt(n))&&n!==Object;)if(n===e)return!0;return e===Object}function U(t){var e=function(){this.constructor.apply(this,arguments)},n=t.extend,r=void 0,i=void 0;return Ot(e,Et),h(n)&&n!==Object||(n=Et),r=n.prototype,i=Ct(r),e.superclass=r,e.prototype=i,xt(e,n),delete t.extend,e.extend(t)}function W(t){return W.proxy(t)}function J(t){var e=t!==Tt?function(t,e){W[e]=t}:function(t,e){W[e]=qt.emptyFunc};qt.each(It,e),qt.each(t,function(t,e){W[e]=t})}function Q(t,e,n){var r=qt.getOwnProp(t,$t.observerKey);return!!r&&(1==arguments.length?r.hasListen():2==arguments.length?r.hasListen(e):r.hasListen(e,n))}function Z(t,e,n){var r=qt.getOwnProp(t,$t.observerKey);return r||(t=W.obj(t),r=new zt(t),t[$t.observerKey]=r),r.on(e,n)}function tt(t,e,n){var r=qt.getOwnProp(t,$t.observerKey);return r&&(t=2==arguments.length?r.un(e):r.un(e,n),!r.hasListen())?(t[$t.observerKey]=void 0,r.destroy()):t}var et=void 0,nt={request:t,cancel:e};window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||nt.request,window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||nt.cancel,n(Function,"bind",function(t){var e=this,n=Array.prototype.slice.call(arguments,1);return function(){return e.apply(t,n.concat(Array.prototype.slice.call(arguments)))}}),Object.freeze||(Object.freeze=function(t){return t});var rt=Object.prototype.toString,it=Object.prototype.hasOwnProperty,ot="[object Arguments]",st="[object Array]",ct="[object Function]",at="[object Boolean]",ut="[object Number]",ht="[object Date]",ft="[object String]",lt="[object Object]",pt="[object RegExp]",dt="[object NodeList]",vt=/^[a-z]/,gt=/^\s+/,yt=/\s+$/,bt=/(^\s+)|(\s+$)/g,_t=/%%|%(\d+\$)?([-+#0 ]*)(\*\d+\$|\*|\d+)?(\.(\*\d+\$|\*|\d+))?([scboxXuidfegpEGP])/g,mt={},Pt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,wt=/\\(\\)?/g,jt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__},xt=Object.setPrototypeOf||function(t,e){t.__proto__=e},Ot=Object.assign||function(t){for(var e=void 0,n=void 0,r=1,i=arguments.length;r<i;r++){e=arguments[r];for(n in e)o(e,n)&&(t[n]=e[n])}return t},Ct=Object.create||function(t,e){X.prototype=t;var n=new X;return X.prototype=void 0,e&&m(e,function(t,e){n[e]=t.value}),n},Et=function(){};Ot(Et.prototype,{super:function(t){var e=arguments.callee.caller;e.$owner.superclass[e.$name].apply(this,t)},superclass:function(){var t=arguments.callee.caller;return t.$owner.superclass}}),Ot(Et,{extend:function(t){var e=this;return t&&!function(){var n=e.prototype;m(t,function(t,r){h(t)&&(t.$owner=e,t.$name=r),n[r]=t}),e.assign(t.statics)}(),this},assign:function(t){return t&&Ot(this,t),this}});var Ft=Object.freeze({overrideHasOwnProlicy:r,hasOwnProlicy:i,hasOwnProp:o,isDefine:s,isNull:c,isNil:a,isArray:u,isFunc:h,isNumber:f,isBool:l,isDate:p,isString:d,isObject:v,isRegExp:g,isArrayLike:y,each:m,map:P,filter:w,aggregate:j,keys:x,indexOf:F,lastIndexOf:S,convert:A,reverseConvert:R,upperFirst:k,ltrim:B,rtrim:L,trim:q,format:M,_format:T,parseExpr:I,get:G,has:D,set:V,getOwnProp:$,prototypeOf:jt,setPrototypeOf:xt,assign:Ot,assignIf:z,emptyFunc:X,create:Ct,isExtendOf:Y,dynamicClass:U}),St=U({constructor:function(t){this.cfg=t||{}},register:function(t,e){var n=this;return 1==arguments.length?m(t,function(t,e){n.cfg[e]=t}):this.cfg[t]=e,this},config:function(t){var e=this;return t&&m(this.cfg,function(n,r){o(t,r)&&(e.cfg[r]=t[r])}),this},get:function(t){return arguments.length?this.cfg[t]:Ct(this.cfg)}}),At=["debug","info","warn","error"],Rt=document.createElement("div"),Nt=Array.prototype.slice,kt=U({constructor:function(){Rt.innerHTML='<div id="simulation_console"\n    style="position:absolute; top:0; right:0; font-family:courier,monospace; background:#eee; font-size:10px; padding:10px; width:200px; height:200px;">\n  <a style="float:right; padding-left:1em; padding-bottom:.5em; text-align:right;">Clear</a>\n  <div id="simulation_console_body"></div>\n</div>',this.el=Rt.childNodes[0],this.clearEl=this.el.childNodes[0],this.bodyEl=this.el.childNodes[1]},appendTo:function(t){t.appendChild(this.el)},log:function(t,e){Rt.innerHTML='<span style="'+t+'">'+e+"</span>",this.bodyEl.appendChild(Rt.childNodes[0])},parseMsg:function(t){var e=t[0];if(d(e)){var n=T.apply(null,t);return[n.format].concat(Nt.call(t,n.formatArgCount)).join(" ")}return t.join(" ")},debug:function(){this.log("color: red;",this.parseMsg(arguments))},info:function(){this.log("color: red;",this.parseMsg(arguments))},warn:function(){this.log("color: red;",this.parseMsg(arguments))},error:function(){this.log("color: red;",this.parseMsg(arguments))},clear:function(){this.bodyEl.innerHTML=""}}),Bt=window.console;Bt&&!Bt.debug&&(Bt.debug=function(){Function.apply.call(Bt.log,Bt,arguments)});var Lt=U({statics:{enableSimulationConsole:function(){Bt||(Bt=new kt,Bt.appendTo(document.body))}},constructor:function(t,e){this.module=t,this.level=F(At,e||"info")},setLevel:function(t){this.level=F(At,t||"info")},getLevel:function(){return At[this.level]},_print:function(t,e,n){Function.apply.call(Bt[t],Bt,e),n&&Bt.trace&&Bt.trace()},_log:function(t,e,n){if(!(t<this.level)&&Bt){var r="[%s] %s -"+(d(e[0])?" "+e.shift():""),i=[];e=w(e,function(t){return!(t instanceof Error)||(i.push(t),!1)}),m(i,function(t){e.push.call(e,t.message,"\n",t.stack)}),t=At[t],this._print(t,[r,t,this.module].concat(e),n)}},debug:function(){this._log(0,Nt.call(arguments,0))},info:function(){this._log(1,Nt.call(arguments,0))},warn:function(){this._log(2,Nt.call(arguments,0))},error:function(){this._log(3,Nt.call(arguments,0))}});Lt.logger=new Lt("default","info");var qt=z({timeoutframe:nt,Configuration:St,Logger:Lt},Ft),Ht=new qt.Configuration,Kt=Object.prototype.hasOwnProperty,Mt="proxyListenKey";Ht.register(Mt,"__PROXY_LISTENERS__");var Tt={eq:function(t,e){return t===e},obj:function(t){return t},proxy:function(t){return t}},It={change:function(t,e){var n=qt.getOwnProp(t,Ht.get(Mt));if(n)for(var r=n.length;r--;)n[r](t,e)},on:function(t,e){if(!qt.isFunc(e))throw TypeError("Invalid Proxy Event Handler["+e);var n=Ht.get(Mt),r=qt.getOwnProp(t,n);r||(t[n]=r=[]),r.push(e)},un:function(t,e){var n=qt.getOwnProp(t,Ht.get(Mt));if(n&&qt.isFunc(e))for(var r=n.length;r-- >0;)if(n[r]===e)return n.splice(r,1),!0;return!1},clean:function(t){t[W.listenKey]&&(t[W.listenKey]=void 0)}},Gt=!1;qt.assign(W,{isEnable:function(){return W.on!==qt.emptyFunc},enable:function(t){J(t),Gt||(qt.overrideHasOwnProlicy(function(t){return Kt.call(W.obj(this),t)}),qt.get=function(t,e,n,r,i){for(var o=0,s=qt.parseExpr(e,!0),c=s.length-1,a=void 0;!qt.isNil(t)&&o<c;){if(a=s[o++],t=W.obj(t),i&&!Kt.call(t,a))return n;t=t[a]}return t=W.obj(t),a=s[o],o==c&&!qt.isNil(t)&&(i?Kt.call(t,a):a in t)?t[a]:n},Gt=!0)},disable:function(){J(Tt)}}),W.disable();var Dt=new qt.Logger("observer","info"),Vt=qt.timeoutframe,$t=Ht.get();Ht.register({lazy:!0,animationFrame:!0,observerKey:"__OBSERVER__",expressionKey:"__EXPR_OBSERVER__"});var zt=qt.dynamicClass({constructor:function(t){this.target=t,this.obj=t,this.listens={},this.changeRecords={},this._notify=this._notify.bind(this),this.watchPropNum=0,this._init()},_fire:function(t,e,n){var r=this,i=this.listens[t];!i||W.eq(e,n)&&!qt.isArray(e)||qt.each(i.slice(),function(i){i(t,e,n,r.target)})},_notify:function(){var t=this,e=this.obj,n=this.changeRecords;this.request_frame=void 0,this.changeRecords={},qt.each(n,function(n,r){t._fire(r,e[r],n)})},_addChangeRecord:function(t,e){$t.lazy?t in this.changeRecords||(this.changeRecords[t]=e,this.request_frame||(this.request_frame=$t.animationFrame?window.requestAnimationFrame(this._notify):Vt.request(this._notify))):this._fire(t,this.obj[t],e)},checkHandler:function(t){if(!qt.isFunc(t))throw TypeError("Invalid Observe Handler")},hasListen:function(t,e){switch(arguments.length){case 0:return!!this.watchPropNum;case 1:return qt.isFunc(t)?!qt.each(this.listens,function(e){return qt.lastIndexOf(e,t)!==-1}):!!this.listens[t];default:return this.checkHandler(e),qt.lastIndexOf(this.listens[t],e)!==-1}},on:function(t,e){var n=void 0;return this.checkHandler(e),(n=this.listens[t])?n.push(e):(this.listens[t]=[e],this.watchPropNum++,this._watch(t)),this.target},_cleanListen:function(t){this.listens[t]=void 0,this.watchPropNum--,this._unwatch(t)},un:function(t,e){var n=this.listens[t];if(n)if(1==arguments.length)this._cleanListen(t);else{this.checkHandler(e);for(var r=n.length;r--;)if(n[r]===e){n.splice(r,1),n.length||this._cleanListen(t);break}}return this.target},destroy:function(){this.request_frame&&($t.animationFrame?window.cancelAnimationFrame(this.request_frame):Vt.cancel(this.request_frame),this.request_frame=void 0);var t=this.obj;return this._destroy(),this.obj=void 0,this.target=void 0,this.listens=void 0,this.changeRecords=void 0,t},_init:qt.emptyFunc,_destroy:qt.emptyFunc,_watch:qt.emptyFunc,_unwatch:qt.emptyFunc}),Xt=0,Yt=qt.dynamicClass({constructor:function(t,e,n){this.id=Xt++,this.expr=e,this.handlers=[],this.observers=[],this.path=n||qt.parseExpr(e),this.observeHandlers=this._initObserveHandlers(),this.obj=W.obj(t),this.target=this._observe(this.obj,0),W.isEnable()&&(this._onTargetProxy=this._onTargetProxy.bind(this),W.on(t,this._onTargetProxy))},_onTargetProxy:function(t,e){this.target=e},_observe:function(t,e){var n=this.path[e],r=void 0;return e+1<this.path.length&&(r=t[n])&&(r=this._observe(W.obj(r),e+1),W.isEnable()&&(t[n]=r)),Z(t,n,this.observeHandlers[e])},_unobserve:function(t,e){var n=this.path[e],r=void 0,i=void 0;return i=tt(t,n,this.observeHandlers[e]),e+1<this.path.length&&(r=t[n])&&(r=this._unobserve(W.obj(r),e+1),W.isEnable()&&(t[n]=r)),i},_initObserveHandlers:function(){return qt.map(this.path,function(t,e){return this._createObserveHandler(e)},this)},_createObserveHandler:function(t){var e=this,n=this.path.slice(0,t+1),r=this.path.slice(t+1),i=this.path.length-t-1;return function(o,s,c){if(i){if(s){var a=W.obj(s),u=e.obj;if(s=qt.get(a,r),a=e._observe(a,t+1),W.isEnable()){for(var h=0;h<t;)if(u=W.obj(u[n[h++]]),!u)return;u[n[h]]=a}}else s=void 0;if(c?(c=W.obj(c),e._unobserve(c,t+1),c=qt.get(c,r)):c=void 0,W.eq(s,c))return}qt.each(e.handlers.slice(),function(t){t(this.expr,s,c,this.target)},e)}},checkHandler:function(t){if(!qt.isFunc(t))throw TypeError("Invalid Observe Handler")},on:function(t){return this.checkHandler(t),this.handlers.push(t),this},un:function(t){if(arguments.length){this.checkHandler(t);for(var e=this.handlers,n=e.length;n--;)if(e[n]===t){e.splice(n,1);break}}else this.handlers=[];return this},hasListen:function(t){return arguments.length?qt.lastIndexOf(this.handlers,t)!=-1:!!this.handlers.length},destory:function(){W.un(this.target,this._onTargetProxy);var t=this._unobserve(this.obj,0);return this.obj=void 0,this.target=void 0,this.expr=void 0,this.handlers=void 0,this.path=void 0,this.observers=void 0,this.observeHandlers=void 0,this.target=void 0,t}}),Ut=[],Wt=!1,Jt={registerPolicy:function(t,e,n,r){return Ut.push({name:t,priority:e,policy:r,checker:n}),Ut.sort(function(t,e){return t.priority-e.priority}),Dt.info("register observe policy[%s], priority is %d",t,e),this},init:function(t){if(!Wt){if(Ht.config(t),qt.each(Ut,function(t){if(t.checker($t))return qt.each(t.policy($t),function(t,e){zt.prototype[e]=t}),$t.policy=t.name,Dt.info("apply observe policy[%s], priority is %d",t.name,t.priority),!1})!==!1)throw Error("observer is not supported");Wt=!0}return this},on:function(t,e,n){var r=qt.parseExpr(e);if(r.length>1){var i=qt.getOwnProp(t,$t.expressionKey),o=i?i[e]:void 0;return o||(o=new Yt(t,e,r),i||(i=t[$t.expressionKey]={}),i[e]=o),o.on(n),o.target}return Z(t,e,n)},un:function(t,e,n){var r=qt.parseExpr(e);if(r.length>1){var i=qt.getOwnProp(t,$t.expressionKey),o=i?i[e]:void 0;return o?(2==arguments.length?o.un():o.un(n),o.hasListen()?o.target:(i[e]=void 0,o.destory())):W.proxy(t)||t}return 2==arguments.length?tt(t,e):tt(t,e,n)},hasListen:function(t,e,n){var r=arguments.length;switch(r){case 1:return Q(t);case 2:if(qt.isFunc(e))return Q(t,e)}var i=qt.parseExpr(e);if(i.length>1){var o=qt.getOwnProp(t,$t.expressionKey),s=o?o[e]:void 0;return!!s&&(2==r||s.hasListen(n))}return Q.apply(window,arguments)}};Ht.register({es6Proxy:!0,es6SourceKey:"__ES6_PROXY_SOURCE__",es6ProxyKey:"__ES6_PROXY__"});var Qt=Object.prototype.hasOwnProperty;Jt.registerPolicy("ES6Proxy",1,function(t){return window.Proxy&&t.es6Proxy!==!1},function(t){var e=t.es6SourceKey,n=t.es6ProxyKey;return W.enable({obj:function(t){return t&&Qt.call(t,e)?t[e]:t},eq:function(t,e){return t===e||t&&e&&W.obj(t)===W.obj(e)},proxy:function(t){return t&&Qt.call(t,n)?t[n]:t}}),{_init:function(){this.obj=W.obj(this.target),this.es6proxy=!1},_destroy:function(){this.es6proxy=!1,this.obj[n]=void 0,W.change(this.obj,void 0)},_watch:function(t){if(!this.es6proxy){var r=this._objectProxy(),i=this.obj;this.target=r,i[n]=r,i[e]=i,W.change(i,r),this.es6proxy=!0}},_unwatch:function(t){},_objectProxy:function(){var t=this;return new Proxy(this.obj,{set:function(e,n,r){if(t.listens[n]){var i=e[n];e[n]=r,t._addChangeRecord(n,i)}else e[n]=r;return!0}})}}});var Zt=Object.prototype.hasOwnProperty,te="hasOwnProperty,toString,toLocaleString,isPrototypeOf,propertyIsEnumerable,valueOf".split(","),ee="concat,copyWithin,entries,every,fill,filter,find,findIndex,forEach,indexOf,lastIndexOf,length,map,keys,join,pop,push,reverse,reverseRight,some,shift,slice,sort,splice,toSource,unshift".split(","),ne=qt.dynamicClass({constBind:"__VB_CONST__",descBind:"__VB_PROXY__",classNameGenerator:0,constructor:function(t,e){this.classPool={},this.defPropMap={},this.onProxyChange=e,this.addDefProps(t),this.initConstScript()},setConstBind:function(t){this.constBind=t,this.initConstScript()},setDescBind:function(t){this.descBind=t,this.initConstScript()},addDefProps:function(t){var e=this.defPropMap,n=[];qt.each(t||[],function(t){e[t]=!0});for(var r in e)Zt.call(e,r)&&n.push(r);this.defProps=n,this.initReserveProps()},initReserveProps:function(){this.reserveProps=te.concat(this.defProps),this.reserveArrayProps=this.reserveProps.concat(ee),this.reservePropMap=qt.reverseConvert(this.reserveProps),this.reserveArrayPropMap=qt.reverseConvert(this.reserveArrayProps)},initConstScript:function(){this.constScript=["\tPublic [",this.descBind,"]\r\n","\tPublic Default Function [",this.constBind,"](desc)\r\n","\t\tset [",this.descBind,"] = desc\r\n","\t\tSet [",this.constBind,"] = Me\r\n","\tEnd Function\r\n"].join("")},generateClassName:function(){return"VBClass"+this.classNameGenerator++},parseClassConstructorName:function(t){return t+"Constructor"},generateSetter:function(t){var e=this.descBind;return["\tPublic Property Get [",t,"]\r\n","\tOn Error Resume Next\r\n","\t\tSet[",t,"] = [",e,'].get("',t,'")\r\n',"\tIf Err.Number <> 0 Then\r\n","\t\t[",t,"] = [",e,'].get("',t,'")\r\n',"\tEnd If\r\n","\tOn Error Goto 0\r\n","\tEnd Property\r\n"]},generateGetter:function(t){var e=this.descBind;return["\tPublic Property Let [",t,"](val)\r\n","\t\tCall [",e,'].set("',t,'",val)\r\n',"\tEnd Property\r\n","\tPublic Property Set [",t,"](val)\r\n","\t\tCall [",e,'].set("',t,'",val)\r\n',"\tEnd Property\r\n"]},generateClass:function(t,e,n){var r=this,i=["Class ",t,"\r\n",this.constScript,"\r\n"];return qt.each(e,function(t){n[t]?i.push("\tPublic ["+t+"]\r\n"):(i.push.apply(i,r.generateSetter(t)),i.push.apply(i,r.generateGetter(t)))}),i.push("End Class\r\n"),i.join("")},generateClassConstructor:function(t,e,n){var r=[t.length,"[",t.join(","),"]","[",n.join(","),"]"].join(""),i=this.classPool[r];if(i)return i;var o=this.generateClassName();return i=this.parseClassConstructorName(o),parseVB(this.generateClass(o,t,e)),parseVB(["Function ",i,"(desc)\r\n","\tDim o\r\n","\tSet o = (New ",o,")(desc)\r\n","\tSet ",i," = o\r\n","End Function"].join("")),this.classPool[r]=i,i},create:function(t,e){function n(e){qt.isFunc(t[e])&&(a[e]=!0,c.push(e)),s.push(e)}var r=this,i=void 0,o=void 0,s=[],c=[],a={},u=this.descBind;return qt.isArray(t)?(i=this.reserveArrayProps,o=this.reserveArrayPropMap):(i=this.reserveProps,o=this.reservePropMap),qt.each(i,n),qt.each(t,function(t,e){e===u||e in o||n(e)},t,!1),e||(e=this.descriptor(t),e?t=e.obj:e=new re(t,s,this)),proxy=window[this.generateClassConstructor(s,a,c)](e),qt.each(c,function(e){proxy[e]=r.funcProxy(t[e],proxy)}),e.proxy=proxy,this.onProxyChange(t,proxy),proxy},funcProxy:function(t,e){return function(){t.apply(this&&this!=window?this:e,arguments)}},eq:function(t,e){var n=this.descriptor(t),r=this.descriptor(e);return n&&(t=n.obj),r&&(e=r.obj),t===e},obj:function(t){var e=this.descriptor(t);return e?e.obj:t},proxy:function(t){var e=this.descriptor(t);return e?e.proxy:void 0},isProxy:function(t){return Zt.call(t,this.constBind)},descriptor:function(t){var e=this.descBind;return Zt.call(t,e)?t[e]:void 0},destroy:function(t){var e=this.descriptor(t);return e&&(t=e.obj,this.onProxyChange(t,void 0)),t}}),re=qt.dynamicClass({constructor:function(t,e,n){this.classGenerator=n,this.obj=t,this.defines=qt.reverseConvert(e,function(){return!1}),t[n.descBind]=this,this.accessorNR=0},isAccessor:function(t){return t&&(t.get||t.set)},hasAccessor:function(){return!!this.accessorNR},defineProperty:function(t,e){var n=this.defines,r=this.obj;return t in n||(t in r?qt.isFunc(r[t])&&console.warn("defineProperty not support function ["+t+"]"):r[t]=void 0,this.classGenerator.create(this.obj,this)),this.isAccessor(e)?(n[t]=e,this.accessorNR++,e.get&&(r[t]=e.get())):(n[t]&&(n[t]=!1,this.accessorNR--),r[t]=e.value),this.proxy},getPropertyDefine:function(t){return this.defines[t]||void 0},get:function(t){var e=this.defines[t];return e&&e.get?e.get.call(this.proxy):this.obj[t]},set:function(t,e){var n=this.defines[t];n&&n.set&&n.set.call(this.proxy,e),this.obj[t]=e}}),ie=void 0;ne.isSupport=function(){if(void 0!==ie)return ie;if(ie=!1,window.VBArray)try{window.execScript(["Function parseVB(code)","\tExecuteGlobal(code)","End Function"].join("\n"),"VBScript"),ie=!0}catch(t){console.error(t.message,t)}return ie},Ht.register({defaultProps:[]});var oe={_init:function(){this.watchers={}},_destroy:function(){for(var t in this.watchers)this.watchers[t]&&this._unwatch(t);this.watchers=void 0},_watch:function(t){this.watchers[t]||(this._defineProperty(t,this.obj[t]),this.watchers[t]=!0)},_unwatch:function(t){this.watchers[t]&&this._undefineProperty(t,this.obj[t])}};Jt.registerPolicy("ES5DefineProperty",10,function(t){if(Object.defineProperty)try{var e=function(){var t=void 0,e={};return Object.defineProperty(e,"sentinel",{get:function(){return t},set:function(e){t=e}}),e.sentinel=1,{v:e.sentinel===t}}();if("object"==typeof e)return e.v}catch(t){}return!1},function(t){return W.disable(),qt.assignIf({_defineProperty:function(t,e){var n=this;Object.defineProperty(this.target,t,{enumerable:!0,configurable:!0,get:function(){return e},set:function(r){var i=e;e=r,n._addChangeRecord(t,i)}})},_undefineProperty:function(t,e){Object.defineProperty(this.target,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}},oe)}),Jt.registerPolicy("DefineGetterAndSetter",20,function(t){return"__defineGetter__"in{}},function(t){return W.disable(),qt.assignIf({_defineProperty:function(t,e){var n=this;this.target.__defineGetter__(t,function(){return e}),this.target.__defineSetter__(t,function(r){var i=e;e=r,n._addChangeRecord(t,i)})},_undefineProperty:function(t,e){this.target.__defineGetter__(t,function(){return e}),this.target.__defineSetter__(t,function(t){e=t})}},oe)}),Jt.registerPolicy("VBScriptProxy",30,function(t){return ne.isSupport()},function(t){var e=oe._init,n=void 0;return W.enable({obj:function(t){return t?n.obj(t):t},eq:function(t,e){return t===e||t&&e&&n.obj(t)===n.obj(e)},proxy:function(t){return t?n.proxy(t):t}}),n=Jt.vbfactory=new ne([W.listenKey,t.observerKey,t.expressionKey].concat(t.defaultProps||[]),W.change),qt.assignIf({_init:function(){e.call(this),this.obj=n.obj(this.target)},_defineProperty:function(t,e){var r=this,i=this.obj,o=n.descriptor(i);o||(o=n.descriptor(n.create(i))),this.target=o.defineProperty(t,{set:function(e){var n=r.obj[t];r.obj[t]=e,r._addChangeRecord(t,n)}})},_undefineProperty:function(t,e){var r=this.obj,i=n.descriptor(r);i&&(this.target=i.defineProperty(t,{value:e}),i.hasAccessor()||(this.target=n.destroy(r)))}},oe)});var se=qt.assign({eq:function(t,e){return W.eq(t,e)},obj:function(t){return W.obj(t)},onproxy:function(t,e){return W.on(t,e)},unproxy:function(t,e){return W.un(t,e)},proxy:W,config:Ht.get()},qt,Jt);return se});
//# sourceMappingURL=observer.all.min.js.map