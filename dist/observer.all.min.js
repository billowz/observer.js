!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("observer",e):t.observer=e()}(this,function(){function t(t){var e=(new Date).getTime(),n=Math.max(0,16-(e-ct)),r=setTimeout(function(){t(e+n)},n);return ct=e+n,r}function e(t){clearTimeout(t)}function n(t,e,n){t.prototype[e]||(t.prototype[e]=n)}function r(t,e){ft[t]=e}function i(t){return ft[t]}function o(t,e){return ft.eq(t,e)}function s(t,e){return ft.hasOwn(t,e)}function c(t){if(null===t||void 0===t)return!0;var e=ut.call(t);switch(e){case vt:case yt:case bt:case dt:return!0}return!1}function a(t){return void 0!==t}function u(t){return null===t}function h(t){return void 0===t||null===t}function f(t){return ut.call(t)===pt}function l(t){return ut.call(t)===dt}function p(t){return ut.call(t)===yt}function d(t){return ut.call(t)===vt}function v(t){return ut.call(t)===gt}function y(t){return ut.call(t)===bt}function g(t){return ut.call(t)===_t}function b(t){return ut.call(t)===mt}function _(t){var e=ut.call(t);switch(e){case lt:case pt:case bt:case Pt:return!0;default:if(t){var n=t.length;return p(n)&&(n?n>0&&n-1 in t:0===n)}return!1}}function m(t,e,n,r){var i=void 0,o=void 0;n=n||t;for(i in t)if(o=s(t,i),(r===!1||o)&&e.call(n,t[i],i,t,o)===!1)return!1;return!0}function P(t,e,n){var r=0,i=t.length;for(n=n||t;r<i;r++)if(e.call(n,t[r],r,t,!0)===!1)return!1;return!0}function j(t,e,n,r){return _(t)?P(t,e,n):!!h(t)||m(t,e,n,r)}function w(t,e,n,r){function i(t,n){o[n]=e.apply(this,arguments)}var o=void 0;return _(t)?(o=[],P(t,i,n)):(o={},h(t)||m(t,i,n,r)),o}function x(t,e,n,r){var i=void 0;return _(t)?(i=[],P(t,function(t){e.apply(this,arguments)&&i.push(t)},n)):(i={},h(t)||m(t,function(t,n){e.apply(this,arguments)&&(i[n]=t)},n,r)),i}function O(t,e,n,r,i){var o=n;return j(t,function(t,n,r,i){o=e.call(this,o,t,n,r,i)},r,i),o}function C(t,e,n,r){var i=[];return j(t,function(t,n){e&&!e.apply(this,arguments)||i.push(n)},n,r),i}function A(t,e,n,r){var i=[];return j(t,function(t,n){e&&!e.apply(this,arguments)||i.push(t)},n,r),i}function E(t,e){for(var n=0,r=t.length;n<r;n++)if(o(t[n],e))return n;return-1}function S(t,e){for(var n=t.length;n-- >0;)if(o(t[n],e))return n}function F(t,e,n){for(key in t)if((n===!1||s(t,key))&&o(t[key],e))return key}function $(t,e,n){return _(t)?E(t,e):F(t,e,n)}function L(t,e,n){return _(t)?S(t,e):F(t,e,n)}function k(t,e,n,r,i){var o={};return j(t,function(t,r){o[e?e.apply(this,arguments):r]=n?n.apply(this,arguments):t},r,i),o}function N(t,e,n,r){var i={};return j(t,function(t,n){i[t]=e?e.apply(this,arguments):n},n,r),i}function R(t){return t.toUpperCase()}function B(t){return t.replace(jt,R)}function q(t){return t.replace(wt,"")}function K(t){return t.replace(xt,"")}function z(t){return t.replace(Ot,"")}function M(t){var e=(t+"").split(".");return e[0]=e[0].replace(Ct,"$1,"),e.join(".")}function T(t){for(var e=void 0,n=0;n<4;n++)if(e=At[n],e.reg.test(t))return t.replace(e.reg,e.rep);return t}function D(t){for(var e=void 0,n=0;n<4;n++)if(e=Et[n],e.reg.test(t))return t.replace(e.reg,e.rep);return t}function I(t,e){if(f(t))return t;if(!y(t))return[];var n=function(){var n=St[t];return n?{v:n}:(n=e?St[t]=[]:[],t.replace(Ft,function(t,e,r,i){n.push(r?i.replace($t,"$1"):e||t)}),{v:n})}();return"object"==typeof n?n.v:void 0}function G(t,e,n,r,i){for(var o=0,c=I(e,!0),a=c.length-1,u=void 0;!h(t)&&o<a;){if(u=c[o++],i&&!s(t,u))return n;t=t[u]}return u=c[o],o==a&&!h(t)&&(i?s(t,u):u in t)?t[u]:n}function V(t,e,n,r){for(var i=0,o=I(e,!0),c=o.length-1,a=void 0;!h(t)&&i<c;){if(a=o[i++],r&&!s(t,a))return!1;t=t[a]}return a=o[i],i==c&&!h(t)&&(r?s(t,a):a in t)}function H(t,e,n){for(var r=0,i=I(e,!0),o=i.length-1,s=i[0],c=t;r<o;r++)c=h(c[s])?c[s]={}:c[s],s=i[r+1];return c[s]=n,t}function X(t,e){return s(t,e)?t[e]:void 0}function Z(t){for(var e=void 0,n=void 0,r=1,i=arguments.length;r<i;r++){e=arguments[r];for(n in e)s(e,n)&&!s(t,n)&&(t[n]=e[n])}return t}function U(){}function Y(t,e){if(!l(t))return t instanceof e;for(var n=t;(n=Lt(n))&&n!==Object;)if(n===e)return!0;return e===Object}function W(t){var e=function(){this.constructor.apply(this,arguments)},n=t.extend,r=void 0,i=void 0;return Nt(e,Bt),l(n)&&n!==Object||(n=Bt),r=n.prototype,i=Rt(r),e.superclass=r,e.prototype=i,kt(e,n),delete t.extend,e.extend(t)}function J(t,e,n,r){var i=t.length,o=i>=e?"":Array(1+e-i>>>0).join(n);return r?t+o:o+t}function Q(t,e){function n(t){return t=t?"*"==t?+e[i++]:"$"==t?+e[i]:"$"==t.charAt(t.length-1)?+e[t.slice(0,-1)-1]:+t:0,isFinite(t)?t<0?0:t:0}function r(t){return t&&"*"!=t?"$"==t?e[i]:e[t.slice(0,-1)-1]:e[i++]}var i=0;return t=t.replace(Mt,function(t,e,i,o,s,c){if("%"===c)return"%";var a=r(e);o=n(o),s=s&&n(s.slice(1)),s||0===s||(s="fFeE".indexOf(c)==-1?"d"==c?0:void 0:6);var u=!1,f="",l=!1,p=!1,d=!1,v=void 0,y=void 0;switch(i&&j(i,function(t){switch(t){case" ":case"+":f=t;break;case"-":u=!0;break;case"0":l=!0;break;case"#":p=!0;break;case",":d=!0}}),c){case"c":return String.fromCharCode(+a);case"s":return h(a)&&!isNaN(a)?"":(a+="",s&&a.length>s&&(a=a.slice(0,s)),a.length<o&&(a=J(a,o,l?"0":" ",!1)),a);case"d":return a=parseInt(a),isNaN(a)?"":(a<0?(v="-",a=-a):v=f,a+="",a.length<o&&(a=J(a,o,"0",!1)),d&&(a=a.replace(Tt,"$1,")),v+a);case"e":case"E":case"f":case"g":case"G":case"p":case"P":var g=+a;if(isNaN(g))return"";g<0?(v="-",g=-g):v=f;var b=void 0,_=c.toLowerCase();if("p"!=_)b=["toExponential","toFixed","toPrecision"]["efg".indexOf(_)];else{var m=String(a).replace(/[eE].*|[^\d]/g,"");m=(g?m.replace(/^0+/,""):m).length,s&&(s=Math.min(s,m)),b=!s||s<=m?"toPrecision":"toExponential"}if(g=g[b](s),g.length<o&&(g=J(g,o,"0",!1)),d){var P=g.split(".");P[0]=P[0].replace(Tt,"$1,"),g=P.join(".")}return a=v+g,"EGP".indexOf(c)!=-1?a.toUpperCase():a;case"b":y=2;break;case"o":y=8;break;case"u":y=10;break;case"x":case"X":y=16;break;case"n":return"";default:return t}var w=a>>>0;return v=p&&10!=y&&w&&["0b","0","0x"][y>>3]||"",w=w.toString(y),w.length<o&&(w=J(w,o,"0",!1)),a=v+w,"X"==c?a.toUpperCase():a}),{format:t,count:i}}function tt(t){return Q(t,Array.prototype.slice.call(arguments,1)).format}function et(t){return et.proxy(t)}function nt(t){var e=t!==ee?function(t,e){et[e]=t}:function(t,e){et[e]=Yt.emptyFunc};Yt.each(ne,e),Yt.each(t,function(t,e){et[e]=t})}function rt(t,e,n){var r=Yt.getOwnProp(t,se.observerKey);return!!r&&(1==arguments.length?r.hasListen():2==arguments.length?r.hasListen(e):r.hasListen(e,n))}function it(t,e,n){var r=Yt.getOwnProp(t,se.observerKey);return r||(r=new ae(t),t[se.observerKey]=r),r.on(e,n)}function ot(t,e,n){var r=Yt.getOwnProp(t,se.observerKey);return r?2==arguments.length?r.un(e):r.un(e,n):t}function st(t,e,n,r,i){var o=this;return t(e,function(t,e,r,i){return n.call(o,et.proxy(t),e,r,i)},r,i)}var ct=void 0,at={request:t,cancel:e};window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||at.request,window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||at.cancel,n(Function,"bind",function(t){var e=this,n=Array.prototype.slice.call(arguments,1);return function(){return e.apply(t,n.concat(Array.prototype.slice.call(arguments)))}}),Object.freeze||(Object.freeze=function(t){return t});var ut=Object.prototype.toString,ht=Object.prototype.hasOwnProperty,ft={hasOwn:function(t,e){return ht.call(t,e)},eq:function(t,e){return t===e}},lt="[object Arguments]",pt="[object Array]",dt="[object Function]",vt="[object Boolean]",yt="[object Number]",gt="[object Date]",bt="[object String]",_t="[object Object]",mt="[object RegExp]",Pt="[object NodeList]",jt=/^[a-z]/,wt=/^\s+/,xt=/\s+$/,Ot=/(^\s+)|(\s+$)/g,Ct=/(\d)(?=(\d{3})+(?!\d))/g,At=[{reg:/([a-zA-Z]+[^aeiou])y$/,rep:"$1ies"},{reg:/([a-zA-Z]+[aeiou]y)$/,rep:"$1s"},{reg:/([a-zA-Z]+[sxzh])$/,rep:"$1es"},{reg:/([a-zA-Z]+[^sxzhy])$/,rep:"$1s"}],Et=[{reg:/([a-zA-Z]+[^aeiou])ies$/,rep:"$1y"},{reg:/([a-zA-Z]+[aeiou])s$/,rep:"$1"},{reg:/([a-zA-Z]+[sxzh])es$/,rep:"$1"},{reg:/([a-zA-Z]+[^sxzhy])s$/,rep:"$1"}],St={},Ft=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,$t=/\\(\\)?/g,Lt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__},kt=Object.setPrototypeOf||function(t,e){t.__proto__=e},Nt=Object.assign||function(t){for(var e=void 0,n=void 0,r=1,i=arguments.length;r<i;r++){e=arguments[r];for(n in e)s(e,n)&&(t[n]=e[n])}return t},Rt=Object.create||function(t,e){U.prototype=t;var n=new U;return U.prototype=void 0,e&&j(e,function(t,e){n[e]=t.value}),n},Bt=function(){},qt=[];Nt(Bt.prototype,{super:function(t){var e=arguments.callee.caller;e.$owner.superclass[e.$name].apply(this,t||qt)},superclass:function(){var t=arguments.callee.caller;return t.$owner.superclass}}),Nt(Bt,{extend:function(t){var e=this;if(t){var n=this.prototype;j(t,function(t,r){l(t)&&(t.$owner=e,t.$name=r),n[r]=t}),this.assign(t.statics)}return this},assign:function(t){return t&&Nt(this,t),this}});var Kt=Object.freeze({overridePolicy:r,policy:i,eq:o,hasOwnProp:s,isPrimitive:c,isDefine:a,isNull:u,isNil:h,isArray:f,isFunc:l,isNumber:p,isBool:d,isDate:v,isString:y,isObject:g,isRegExp:b,isArrayLike:_,each:j,map:w,filter:x,aggregate:O,keys:C,values:A,indexOf:$,lastIndexOf:L,convert:k,reverseConvert:N,upperFirst:B,ltrim:q,rtrim:K,trim:z,thousandSeparate:M,plural:T,singular:D,parseExpr:I,get:G,has:V,set:H,getOwnProp:X,prototypeOf:Lt,setPrototypeOf:kt,assign:Nt,assignIf:Z,emptyFunc:U,create:Rt,isExtendOf:Y,dynamicClass:W}),zt=W({constructor:function(t){this.cfg=t||{}},register:function(t,e){var n=this;return 1==arguments.length?j(t,function(t,e){n.cfg[e]=t}):this.cfg[t]=e,this},config:function(t){var e=this;return t&&j(this.cfg,function(n,r){s(t,r)&&(e.cfg[r]=t[r])}),this},get:function(t){return arguments.length?this.cfg[t]:Rt(this.cfg)}}),Mt=/%(\d+\$|\*|\$)?([-+#0, ]*)?(\d+\$?|\*|\$)?(\.\d+\$?|\.\*|\.\$)?([%sfducboxXeEgGpP])/g,Tt=/(\d)(?=(\d{3})+(?!\d))/g;tt.format=Q;var Dt=["debug","info","warn","error"],It=document.createElement("div"),Gt=Array.prototype.slice,Vt=W({constructor:function(){It.innerHTML='<div id="simulation_console"\n    style="position:absolute; top:0; right:0; font-family:courier,monospace; background:#eee; font-size:10px; padding:10px; width:200px; height:200px;">\n  <a style="float:right; padding-left:1em; padding-bottom:.5em; text-align:right;">Clear</a>\n  <div id="simulation_console_body"></div>\n</div>',this.el=It.childNodes[0],this.clearEl=this.el.childNodes[0],this.bodyEl=this.el.childNodes[1]},appendTo:function(t){t.appendChild(this.el)},log:function(t,e){It.innerHTML='<span style="'+t+'">'+e+"</span>",this.bodyEl.appendChild(It.childNodes[0])},parseMsg:function(t){var e=t[0];if(y(e)){var n=tt.format.apply(null,t);return[n.format].concat(Gt.call(t,n.count)).join(" ")}return t.join(" ")},debug:function(){this.log("color: red;",this.parseMsg(arguments))},info:function(){this.log("color: red;",this.parseMsg(arguments))},warn:function(){this.log("color: red;",this.parseMsg(arguments))},error:function(){this.log("color: red;",this.parseMsg(arguments))},clear:function(){this.bodyEl.innerHTML=""}}),Ht=window.console;Ht&&!Ht.debug&&(Ht.debug=function(){Function.apply.call(Ht.log,Ht,arguments)});var Xt=W({statics:{enableSimulationConsole:function(){Ht||(Ht=new Vt,Ht.appendTo(document.body))}},constructor:function(t,e){this.module=t,this.level=$(Dt,e||"info")},setLevel:function(t){this.level=$(Dt,t||"info")},getLevel:function(){return Dt[this.level]},_print:function(t,e,n){Function.apply.call(Ht[t],Ht,e),n&&Ht.trace&&Ht.trace()},_log:function(t,e,n){if(!(t<this.level)&&Ht){var r="[%s] %s -"+(y(e[0])?" "+e.shift():""),i=[];e=x(e,function(t){return!(t instanceof Error)||(i.push(t),!1)}),j(i,function(t){e.push.call(e,t.message,"\n",t.stack)}),t=Dt[t],this._print(t,[r,t,this.module].concat(e),n)}},debug:function(){this._log(0,Gt.call(arguments,0))},info:function(){this._log(1,Gt.call(arguments,0))},warn:function(){this._log(2,Gt.call(arguments,0))},error:function(){this._log(3,Gt.call(arguments,0))}});Xt.logger=new Xt("default","info");var Zt=1,Ut=W({statics:{ListKey:"__UTILITY_LIST__"},constructor:function(){this._id=Zt++,this.length=0,this._header=void 0,this._tail=void 0,this._version=1},_listObj:function(t){return s(t,Ut.ListKey)&&t[Ut.ListKey]},_desc:function(t){var e=this._listObj(t);return e&&e[this._id]},_getOrCreateDesc:function(t){var e=this._listObj(t)||(t[Ut.ListKey]={}),n=e[this._id];return n||(e[this._id]={obj:t,prev:void 0,next:void 0,version:this._version++})},_unlink:function(t){var e=t.prev,n=t.next;e?e.next=n:this._header=n,n?n.prev=e:this._tail=e,this.length--},_move:function(t,e,n){var r=this._header;(r===t||t.prev)&&this._unlink(t),t.prev=e,e?(t.next=e.next,e.next=t):(t.next=r,r&&(r.prev=t),this._header=t),this._tail===e&&(this._tail=t),this.length++},_remove:function(t){var e=t.obj,n=this._listObj(e);this._unlink(t),delete n[this._id]},push:function(t){return this.last(t)},pop:function(){var t=this._header;if(t)return this._remove(t),t.obj},shift:function(){var t=this._tail;if(t)return this._remove(t),t.obj},first:function(t){if(0==arguments.length){var e=this._header;return e&&e.obj}return this._move(this._getOrCreateDesc(t),void 0),this},last:function(t){if(0==arguments.length){var e=this._tail;return e&&e.obj}return this._move(this._getOrCreateDesc(t),this._tail),this},before:function(t,e){if(1==arguments.length){var n=this._desc(t),r=n&&n.prev;return r&&r.obj}return this._move(this._getOrCreateDesc(t),this._desc(e).prev),this},after:function(t,e){if(1==arguments.length){var n=this._desc(t),r=n&&n.next;return r&&r.obj}return this._move(this._getOrCreateDesc(t),this._desc(e)),this},contains:function(t){return!!this._desc(t)},remove:function(t){var e=this._listObj(t),n=void 0;return!(!e||!(n=e[this._id]))&&(this._unlink(n),delete e[this._id],!0)},clean:function(){for(var t=this._header;t;)delete this._listObj(t.obj)[this._id],t=t.next;return this._header=void 0,this._tail=void 0,this.length=0,this},empty:function(){return 0==this.length},size:function(){return this.length},each:function(t,e){for(var n=this._header,r=this._version;n;){if(n.version<r&&t.call(e||this,n.obj,this)===!1)return!1;n=n.next}return!0},map:function(t,e){var n=this,r=[];return this.each(function(i){r.push(t.call(e||n,i,n))}),r},filter:function(t,e){var n=this,r=[];return this.each(function(i){t.call(e||n,i,n)&&r.push(i)}),r},toArray:function(){var t=[];return this.each(function(e){t.push(e)}),t}}),Yt=Z({format:tt,timeoutframe:at,Configuration:zt,Logger:Xt,LinkedList:Ut},Kt),Wt=new Yt.Configuration,Jt=Object.prototype.hasOwnProperty,Qt="proxyListenKey",te=Yt.LinkedList;Wt.register(Qt,"__PROXY_LISTENERS__");var ee={eq:function(t,e){return t===e},obj:function(t){return t},proxy:function(t){return t}},ne={change:function(t,e){var n=Yt.getOwnProp(t,Wt.get(Qt));n&&n.each(function(n){return n(t,e)})},on:function(t,e){if(!Yt.isFunc(e))throw TypeError("Invalid Proxy Event Handler["+e);var n=Wt.get(Qt),r=Yt.getOwnProp(t,n);r||(t[n]=r=new te),r.push(e)},un:function(t,e){var n=Yt.getOwnProp(t,Wt.get(Qt));return n&&Yt.isFunc(e)&&n.remove(e),!1},clean:function(t){t[et.listenKey]&&(t[et.listenKey]=void 0)}},re=!1;Yt.assign(et,{isEnable:function(){return et.on!==Yt.emptyFunc},enable:function(t){nt(t),re||(Yt.overridePolicy("hasOwn",function(t,e){return Jt.call(et.obj(t),e)}),Yt.overridePolicy("eq",et.eq),re=!0)},disable:function(){nt(ee)}}),et.disable();var ie=new Yt.Logger("observer","info"),oe=Yt.timeoutframe,se=Wt.get(),ce=Yt.LinkedList;Wt.register({lazy:!0,animationFrame:!0,observerKey:"__OBSERVER__",expressionKey:"__EXPR_OBSERVER__"});var ae=Yt.dynamicClass({constructor:function(t){this.obj=t,this.target=t,this.listens={},this.changeRecords={},this.notify=this.notify.bind(this),this.watchPropNum=0,this.init()},fire:function(t,e,n){var r=this,i=this.listens[t];if(i){var o=Yt.isPrimitive(e),s=et.eq(e,n);o&&s||i.each(function(i){i(t,e,n,r.target,s)})}},notify:function(){var t=this,e=this.obj,n=this.changeRecords;this.request_frame=void 0,this.changeRecords={},Yt.each(n,function(n,r){t.fire(r,e[r],n)})},addChangeRecord:function(t,e){se.lazy?t in this.changeRecords||!this.listens[t]||(this.changeRecords[t]=e,this.request_frame||(this.request_frame=se.animationFrame?window.requestAnimationFrame(this.notify):oe.request(this.notify))):this.fire(t,this.obj[t],e)},hasListen:function(t,e){switch(arguments.length){case 0:return!!this.watchPropNum;case 1:return Yt.isFunc(t)?!Yt.each(this.listens,function(e){return e.contains(t)}):!!this.listens[t];default:var n=this.listens[t];return!!n&&n.contains(e)}},on:function(t,e){var n=void 0;return(n=this.listens[t])||(this.listens[t]=n=new ce),n.empty()&&(this.watchPropNum++,this.watch(t)),n.push(e),this.target},un:function(t,e){var n=this.listens[t];return n&&!n.empty()&&(1==arguments.length?(n.clean(),this.watchPropNum--,this.unwatch(t)):(n.remove(e),n.empty()&&(this.watchPropNum--,this.unwatch(t)))),this.watchPropNum?this.target:this.obj},init:Yt.emptyFunc,watch:Yt.emptyFunc,unwatch:Yt.emptyFunc}),ue=0,he=Yt.dynamicClass({constructor:function(t,e,n){this.id=ue++,this.expr=e,this.handlers=new ce,this.observers=[],this.path=n||Yt.parseExpr(e),this.observeHandlers=this._initObserveHandlers(),this.obj=t,this.target=this._observe(t,0),et.isEnable()&&(this._onTargetProxy=this._onTargetProxy.bind(this),et.on(t,this._onTargetProxy))},_onTargetProxy:function(t,e){this.target=e},_observe:function(t,e){var n=this.path[e],r=void 0;return e+1<this.path.length&&(r=t[n])&&(r=this._observe(et.obj(r),e+1),et.isEnable()&&(t[n]=r)),it(t,n,this.observeHandlers[e])},_unobserve:function(t,e){var n=this.path[e],r=void 0,i=void 0;return i=ot(t,n,this.observeHandlers[e]),e+1<this.path.length&&(r=t[n])&&(r=this._unobserve(et.obj(r),e+1),et.isEnable()&&(t[n]=r)),i},_initObserveHandlers:function(){return Yt.map(this.path,function(t,e){return this._createObserveHandler(e)},this)},_createObserveHandler:function(t){var e=this,n=this.path.slice(0,t+1),r=this.path.slice(t+1),i=this.path.length-t-1;return function(o,s,c,a,u){if(i){if(u)return;if(c?(c=et.obj(c),e._unobserve(c,t+1),c=Yt.get(c,r)):c=void 0,s){var h=et.obj(s);if(s=Yt.get(h,r),h=e._observe(h,t+1),et.isEnable()){for(var f=0,l=e.obj;f<t;)if(l=et.obj(l[n[f++]]),!l)return;l[n[f]]=h}}else s=void 0;var p=Yt.isPrimitive(s);if(u=et.eq(s,c),p&&u)return}e.handlers.each(function(t){return t(e.expr,s,c,e.target,u)})}},on:function(t){return this.handlers.push(t),this},un:function(t){return arguments.length?this.handlers.remove(t):this.handlers.clean(),this},hasListen:function(t){return arguments.length?this.handlers.contains(t):!this.handlers.empty()}}),fe=[],le=!1,pe={on:function(t,e,n){var r=Yt.parseExpr(e);if(t=et.obj(t),r.length>1){var i=Yt.getOwnProp(t,se.expressionKey),o=i?i[e]:void 0;return o||(o=new he(t,e,r),i||(i=t[se.expressionKey]={}),i[e]=o),o.on(n),o.target}return it(t,e,n)},un:function(t,e,n){var r=Yt.parseExpr(e);if(t=et.obj(t),r.length>1){var i=Yt.getOwnProp(t,se.expressionKey),o=i?i[e]:void 0;return o?(2==arguments.length?o.un():o.un(n),o.hasListen()?o.target:o.obj):t}return 2==arguments.length?ot(t,e):ot(t,e,n)},hasListen:function(t,e,n){var r=arguments.length;switch(t=et.obj(t),r){case 1:return rt(t);case 2:if(Yt.isFunc(e))return rt(t,e)}var i=Yt.parseExpr(e);if(i.length>1){var o=Yt.getOwnProp(t,se.expressionKey),s=o?o[e]:void 0;return!!s&&(2==r||s.hasListen(n))}return rt.apply(null,arguments)},registerPolicy:function(t,e,n,r){return fe.push({name:t,priority:e,policy:r,checker:n}),fe.sort(function(t,e){return t.priority-e.priority}),ie.info("register observe policy[%s], priority is %d",t,e),this},init:function(t){if(!le){if(Wt.config(t),Yt.each(fe,function(t){if(t.checker(se))return Yt.each(t.policy(se),function(t,e){ae.prototype[e]=t}),se.policy=t.name,ie.info("apply observe policy[%s], priority is %d",t.name,t.priority),!1})!==!1)throw Error("observer is not supported");le=!0}return this}};Wt.register({es6Proxy:!0,es6SourceKey:"__ES6_PROXY_SOURCE__",es6ProxyKey:"__ES6_PROXY__"});var de=Object.prototype.hasOwnProperty;pe.registerPolicy("ES6Proxy",1,function(t){return window.Proxy&&t.es6Proxy!==!1},function(t){var e=t.es6SourceKey,n=t.es6ProxyKey;return et.enable({obj:function(t){return t&&de.call(t,e)?t[e]:t},eq:function(t,e){return t===e||et.obj(t)===et.obj(e)},proxy:function(t){return t&&de.call(t,n)?t[n]||t:t}}),{init:function(){this.es6proxy=!1},watch:function(t){if(!this.es6proxy){var r=this.objectProxy(),i=this.obj;this.target=r,i[n]=r,i[e]=i,et.change(i,r),this.es6proxy=!0}},unwatch:function(t){},objectProxy:function(){var t=this;return new Proxy(this.obj,{set:function(e,n,r){if(t.listens[n]){var i=e[n];e[n]=r,t.addChangeRecord(n,i)}else e[n]=r;return!0}})}}});var ve=Object.prototype.hasOwnProperty,ye="hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),ge="concat,copyWithin,entries,every,fill,filter,find,findIndex,forEach,includes,indexOf,join,keys,lastIndexOf,map,pop,push,reduce,reduceRight,reverse,shift,slice,some,sort,splice,unshift,values".split(","),be=Yt.dynamicClass({constBind:"__VB_CONST__",descBind:"__VB_PROXY__",classNameGenerator:0,constructor:function(t,e){this.classPool={},this.defPropMap={},this.onProxyChange=e,this.addDefProps(t),this.initConstScript()},setConstBind:function(t){this.constBind=t,this.initConstScript()},setDescBind:function(t){this.descBind=t,this.initConstScript()},addDefProps:function(t){var e=this.defPropMap,n=[];Yt.each(t||[],function(t){e[t]=!0});for(var r in e)ve.call(e,r)&&n.push(r);this.defProps=n,ie.info("VBProxy default props is: ",n.join(",")),this.initReserveProps()},initReserveProps:function(){this.reserveProps=ye.concat(this.defProps),this.reserveArrayProps=this.reserveProps.concat(ge),this.reservePropMap=Yt.reverseConvert(this.reserveProps),this.reserveArrayPropMap=Yt.reverseConvert(this.reserveArrayProps)},initConstScript:function(){this.constScript=["\tPublic [",this.descBind,"]\r\n","\tPublic Default Function [",this.constBind,"](desc)\r\n","\t\tset [",this.descBind,"] = desc\r\n","\t\tSet [",this.constBind,"] = Me\r\n","\tEnd Function\r\n"].join("")},generateClassName:function(){return"VBClass"+this.classNameGenerator++},parseClassConstructorName:function(t){return t+"Constructor"},generateSetter:function(t){var e=this.descBind;return["\tPublic Property Get [",t,"]\r\n","\tOn Error Resume Next\r\n","\t\tSet[",t,"] = [",e,'].get("',t,'")\r\n',"\tIf Err.Number <> 0 Then\r\n","\t\t[",t,"] = [",e,'].get("',t,'")\r\n',"\tEnd If\r\n","\tOn Error Goto 0\r\n","\tEnd Property\r\n"]},generateGetter:function(t){var e=this.descBind;return["\tPublic Property Let [",t,"](val)\r\n","\t\tCall [",e,'].set("',t,'",val)\r\n',"\tEnd Property\r\n","\tPublic Property Set [",t,"](val)\r\n","\t\tCall [",e,'].set("',t,'",val)\r\n',"\tEnd Property\r\n"]},generateClass:function(t,e,n){var r=this,i=["Class ",t,"\r\n",this.constScript,"\r\n"];return Yt.each(e,function(t){n[t]?i.push("\tPublic ["+t+"]\r\n"):(i.push.apply(i,r.generateSetter(t)),i.push.apply(i,r.generateGetter(t)))}),i.push("End Class\r\n"),i.join("")},generateClassConstructor:function(t,e,n){var r=[t.length,"[",t.join(","),"]","[",n.join(","),"]"].join(""),i=this.classPool[r];if(i)return i;var o=this.generateClassName();return i=this.parseClassConstructorName(o),parseVB(this.generateClass(o,t,e)),parseVB(["Function ",i,"(desc)\r\n","\tDim o\r\n","\tSet o = (New ",o,")(desc)\r\n","\tSet ",i," = o\r\n","End Function"].join("")),this.classPool[r]=i,i},create:function(t,e){function n(e){Yt.isFunc(t[e])&&(a[e]=!0,c.push(e)),s.push(e)}var r=this,i=void 0,o=void 0,s=[],c=[],a={},u=this.descBind;return Yt.isArray(t)?(i=this.reserveArrayProps,o=this.reserveArrayPropMap):(i=this.reserveProps,o=this.reservePropMap),Yt.each(i,n),Yt.each(t,function(t,e){e===u||e in o||n(e)},t,!1),e||(e=this.descriptor(t),e?t=e.obj:e=new _e(t,s,this)),proxy=window[this.generateClassConstructor(s,a,c)](e),e.proxy=proxy,Yt.each(c,function(e){proxy[e]=r.funcProxy(t[e],e in o?t:proxy)}),this.onProxyChange(t,proxy),e},funcProxy:function(t,e){return function(){return t.apply(this===window?e:this,arguments)}},eq:function(t,e){var n=this.descriptor(t),r=this.descriptor(e);return n&&(t=n.obj),r&&(e=r.obj),t===e},obj:function(t){var e=this.descriptor(t);return e?e.obj:t},proxy:function(t){var e=this.descriptor(t);return e?e.proxy:void 0},isProxy:function(t){return ve.call(t,this.constBind)},descriptor:function(t){var e=this.descBind;return ve.call(t,e)?t[e]:void 0},destroy:function(t){this.onProxyChange(obj,void 0)}}),_e=Yt.dynamicClass({constructor:function(t,e,n){this.classGenerator=n,this.obj=t,this.defines=Yt.reverseConvert(e,function(){return!1}),t[n.descBind]=this,this.accessorNR=0},isAccessor:function(t){return t&&(t.get||t.set)},hasAccessor:function(){return!!this.accessorNR},defineProperty:function(t,e){var n=this.defines,r=this.obj;return t in n||(t in r?Yt.isFunc(r[t])&&ie.warn("defineProperty not support function ["+t+"]"):r[t]=void 0,this.classGenerator.create(this.obj,this)),this.isAccessor(e)?(n[t]=e,this.accessorNR++,e.get&&(r[t]=e.get())):(n[t]&&(n[t]=!1,this.accessorNR--),r[t]=e.value),this.proxy},getPropertyDefine:function(t){return this.defines[t]||void 0},get:function(t){var e=this.defines[t];return e&&e.get?e.get.call(this.proxy):this.obj[t]},set:function(t,e){var n=this.defines[t];n&&n.set?n.set.call(this.proxy,e):this.obj[t]=e}}),me=void 0;be.isSupport=function(){if(void 0!==me)return me;if(me=!1,window.VBArray)try{window.execScript(["Function parseVB(code)","\tExecuteGlobal(code)","End Function"].join("\n"),"VBScript"),me=!0}catch(t){ie.error(t.message,t)}return me};var Pe="fill,pop,push,reverse,shift,sort,splice,unshift".split(",");Wt.register({defaultProps:[]});var je={init:function(){this.isArray=Yt.isArray(this.obj),this.watchers={},this.isArray&&(this.hookArrayMethod=this.hookArrayMethod.bind(this),this.hookArray())},watch:function(t){var e=this.watchers;e[t]||this.isArray&&"length"==t||(this.defineProperty(t,this.obj[t]),e[t]=!0)},unwatch:function(t){var e=this.watchers;!e[t]||this.isArray&&"length"==t||(this.undefineProperty(t,this.obj[t]),e[t]=!1)},hookArray:function(){Yt.each(Pe,this.hookArrayMethod)},hookArrayMethod:function(t){var e=this.obj,n=Array.prototype[t],r=e.length,i=this;e[t]=function(){var t=n.apply(e,arguments);return i.addChangeRecord("length",r),r=e.length,t}}};pe.registerPolicy("ES5DefineProperty",10,function(t){if(Object.defineProperty)try{var e=function(){var t=void 0,e={};return Object.defineProperty(e,"sentinel",{get:function(){return t},set:function(e){t=e}}),e.sentinel=1,{v:e.sentinel===t}}();if("object"==typeof e)return e.v}catch(t){}return!1},function(t){return Yt.assignIf({defineProperty:function(t,e){var n=this;Object.defineProperty(this.target,t,{enumerable:!0,configurable:!0,get:function(){return e},set:function(r){var i=e;e=r,n.addChangeRecord(t,i)}})},undefineProperty:function(t,e){Object.defineProperty(this.target,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}},je)}),pe.registerPolicy("DefineGetterAndSetter",20,function(t){return"__defineGetter__"in{}},function(t){return Yt.assignIf({defineProperty:function(t,e){var n=this;this.target.__defineGetter__(t,function(){return e}),this.target.__defineSetter__(t,function(r){var i=e;e=r,n.addChangeRecord(t,i)})},undefineProperty:function(t,e){this.target.__defineGetter__(t,function(){return e}),this.target.__defineSetter__(t,function(t){e=t})}},je)}),pe.registerPolicy("VBScriptProxy",30,function(t){return be.isSupport()},function(t){var e=void 0;return et.enable({obj:function(t){return t&&e.obj(t)},eq:function(t,e){return t===e||et.obj(t)===et.obj(e)},proxy:function(t){return t&&(e.proxy(t)||t)}}),e=pe.vbfactory=new be([t.proxyListenKey,t.observerKey,t.expressionKey,Yt.LinkedList.ListKey].concat(t.defaultProps||[]),et.change),Yt.assignIf({defineProperty:function(t,n){var r=this,i=this.obj;this.target=(e.descriptor(i)||e.create(i)).defineProperty(t,{set:function(e){var n=i[t];i[t]=e,r.addChangeRecord(t,n)}})},undefineProperty:function(t,n){var r=this.obj,i=e.descriptor(r);i&&i.defineProperty(t,{value:n})}},je)});var we=Yt.assign({eq:function(t,e){return et.eq(t,e)},obj:function(t){return et.obj(t)},onproxy:function(t,e){return et.on(t,e)},unproxy:function(t,e){return et.un(t,e)},proxy:et,config:Wt.get(),$each:function(t,e,n,r){return st(Yt.each,t,e,n,r)},$map:function(t,e,n,r){return st(Yt.map,t,e,n,r)},$filter:function(t,e,n,r){return st(Yt.filter,t,e,n,r)},$aggregate:function(t,e,n,r,i){var o=n;return each(t,function(t,n,r,i){o=e.call(this,o,et.proxy(t),n,r,i)},r,i),o},$keys:function(t,e,n,r){var i=[];return each(t,function(t,n,r,o){e&&!e.call(this,et.proxy(t),n,r,o)||i.push(n)},n,r),i},$values:function(t,e,n,r){var i=[];return each(t,function(t,n,r,o){e&&!e.call(this,et.proxy(t),n,r,o)||i.push(t)},n,r),i}},pe),xe=Yt.assignIf(Yt.create(we),{observer:we,utility:Yt},Yt);return xe});
//# sourceMappingURL=observer.all.min.js.map